<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quarantine Perennial Football League</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=JetBrains+Mono:wght@400;600&family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-deep: #0a0a0f;
            --bg-card: #12121a;
            --bg-hover: #1a1a25;
            --accent-primary: #4488ff;
            --accent-secondary: #dd2222;
            --accent-tertiary: #6699ff;
            --text-primary: #ffffff;
            --text-secondary: #8888aa;
            --text-muted: #555566;
            --border: #2a2a3a;
            --win: #00ff88;
            --loss: #ff3366;
            --tie: #ffaa00;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-deep);
            color: var(--text-primary);
            min-height: 100vh;
            background-image: 
                radial-gradient(ellipse at 20% 20%, rgba(68, 136, 255, 0.05) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(102, 153, 255, 0.05) 0%, transparent 50%);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem 0;
            position: relative;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent-primary), transparent);
        }

        .league-logo {
            display: block;
            margin: 0 auto 1rem auto;
            width: 120px;
            height: auto;
            filter: drop-shadow(0 0 20px rgba(68, 136, 255, 0.3));
        }

        .logo {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2.5rem;
            letter-spacing: 0.1em;
            color: var(--accent-primary);
            text-align: center;
            text-shadow: 0 0 60px rgba(68, 136, 255, 0.3);
        }

        .season-badge {
            display: inline-block;
            margin-top: 0.5rem;
            padding: 0.25rem 1rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: var(--text-secondary);
            border: 1px solid var(--border);
            border-radius: 2rem;
        }

        .updated {
            margin-top: 1rem;
            font-size: 0.8rem;
            color: var(--text-muted);
            font-family: 'JetBrains Mono', monospace;
        }

        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            background: rgba(221, 34, 34, 0.1);
            border: 1px solid var(--accent-secondary);
            border-radius: 2rem;
            font-size: 0.75rem;
            color: var(--accent-secondary);
            margin-left: 1rem;
        }

        .live-dot {
            width: 6px;
            height: 6px;
            background: var(--accent-secondary);
            border-radius: 50%;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }

        nav {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 0.5rem 1.5rem;
            font-family: 'Outfit', sans-serif;
            font-weight: 600;
            font-size: 0.9rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .nav-btn:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
            border-color: var(--accent-primary);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, rgba(68, 136, 255, 0.2), rgba(102, 153, 255, 0.2));
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }

        .week-selector {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .week-btn {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .week-btn:hover {
            background: var(--bg-hover);
            border-color: var(--accent-tertiary);
            color: var(--text-primary);
        }

        .week-btn.active {
            background: var(--accent-tertiary);
            border-color: var(--accent-tertiary);
            color: var(--bg-deep);
            font-weight: 600;
        }

        .week-btn.playoff {
            border-color: rgba(255, 215, 0, 0.4);
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), transparent);
        }

        .week-btn.playoff:hover {
            border-color: #ffd700;
            background: rgba(255, 215, 0, 0.2);
        }

        .week-btn.playoff.active {
            background: linear-gradient(135deg, #ffd700, #ff8c00);
            border-color: #ffd700;
            color: var(--bg-deep);
        }

        .week-label {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.5rem;
            letter-spacing: 0.1em;
            color: var(--text-secondary);
        }

        .matchups {
            display: grid;
            gap: 1.5rem;
        }

        .matchup-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 1rem;
            overflow: hidden;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .matchup-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .matchup-card.pending {
            opacity: 0.8;
        }

        .matchup-card.pending .vs-text {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .matchup-card.pending.playoff {
            opacity: 1;
            border-color: rgba(255, 215, 0, 0.3);
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.05), transparent);
        }

        .matchup-seed {
            font-size: 0.75rem;
            color: var(--text-muted);
            font-family: 'JetBrains Mono', monospace;
            margin: 0 0.5rem;
        }

        .playoff-bracket-header {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.2rem;
            letter-spacing: 0.1em;
            padding: 1rem 0 0.5rem;
            margin-top: 1rem;
            border-top: 1px solid var(--border);
        }

        .playoff-bracket-header:first-child {
            margin-top: 0;
            border-top: none;
            padding-top: 0;
        }

        .playoff-bracket-header.playoffs {
            color: #ffd700;
        }

        .playoff-bracket-header.championship {
            color: #ffd700;
        }

        .playoff-bracket-header.consolation_cup {
            color: #cd7f32;
        }

        .playoff-bracket-header.mid_bowl {
            color: #6b8e23;
        }

        .playoff-bracket-header.sewer_series {
            color: #708090;
        }

        .playoff-bracket-header.toilet_bowl {
            color: #a87c4f;
        }

        .playoff-round-badge {
            background: linear-gradient(135deg, #ffd700, #ff8c00);
            color: var(--bg-deep);
            padding: 0.25rem 0.75rem;
            border-radius: 0.25rem;
            font-style: normal;
            font-weight: 600;
            font-size: 0.9rem;
            margin-right: 0.5rem;
        }

        .no-scores-message {
            text-align: center;
            padding: 1.5rem;
            color: var(--text-secondary);
            font-style: italic;
            margin-bottom: 1rem;
        }

        .no-scores-message.playoffs {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), transparent);
            border-radius: 0.5rem;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .matchup-header {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            padding: 1.5rem;
            gap: 1rem;
        }

        .team {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .team.right {
            text-align: right;
        }

        .team-name {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--text-primary);
        }

        .team-owner {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .vs-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .score-display {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-family: 'JetBrains Mono', monospace;
        }

        .score {
            font-size: 1.8rem;
            font-weight: 600;
            min-width: 60px;
            text-align: center;
        }

        .score.winning {
            color: var(--win);
        }

        .score.losing {
            color: var(--text-muted);
        }

        .score-divider {
            color: var(--text-muted);
            font-size: 1.2rem;
        }

        .expand-btn {
            width: 100%;
            padding: 0.75rem;
            background: var(--bg-hover);
            border: none;
            border-top: 1px solid var(--border);
            color: var(--text-muted);
            font-family: 'Outfit', sans-serif;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .expand-btn:hover {
            background: var(--bg-card);
            color: var(--text-secondary);
        }

        .roster-panel {
            display: none;
            padding: 1.5rem;
            border-top: 1px solid var(--border);
            background: rgba(0, 0, 0, 0.2);
        }

        .roster-panel.expanded {
            display: block;
        }

        .roster-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .roster-column h4 {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
        }

        .player-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
        }

        .player-row.bench {
            opacity: 0.4;
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .position-tag {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.65rem;
            font-weight: 600;
            padding: 0.15rem 0.35rem;
            background: var(--bg-deep);
            border-radius: 0.25rem;
            color: var(--text-muted);
        }

        .player-name {
            font-size: 0.9rem;
        }

        .player-team {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .player-score {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            font-weight: 600;
        }

        /* Standings */
        .standings-table {
            width: 100%;
            border-collapse: collapse;
        }

        .standings-table th {
            text-align: left;
            padding: 1rem;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            border-bottom: 1px solid var(--border);
        }

        .standings-table th.num {
            text-align: right;
        }

        .standings-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .standings-table td.num {
            text-align: right;
            font-family: 'JetBrains Mono', monospace;
        }

        .standings-table tr:hover {
            background: var(--bg-hover);
        }

        .rank {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            color: var(--text-muted);
        }

        .rank.playoffs {
            color: var(--accent-primary);
        }

        .rank.toilet-bowl {
            color: var(--accent-secondary);
        }

        .record {
            color: var(--text-secondary);
        }

        .rank-points {
            color: var(--accent-primary);
            font-weight: 600;
        }

        .top-half {
            color: var(--accent-tertiary);
        }

        .points-for {
            color: var(--text-secondary);
        }

        .points-against {
            color: var(--text-muted);
        }

        .team-code {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-left: 0.5rem;
        }

        .playoff-label {
            font-size: 0.7rem;
            padding: 0.15rem 0.4rem;
            border-radius: 0.25rem;
            margin-left: 0.5rem;
            font-weight: 600;
        }

        .playoff-label.playoffs {
            background: rgba(68, 136, 255, 0.15);
            color: var(--accent-primary);
        }

        .playoff-label.toilet {
            background: rgba(221, 34, 34, 0.15);
            color: var(--accent-secondary);
        }

        /* Team Pages */
        .team-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 2rem;
            justify-content: center;
        }

        .team-btn {
            padding: 0.75rem 1.25rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }

        .team-btn:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
            border-color: var(--accent-primary);
        }

        .team-btn.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: var(--bg-deep);
            font-weight: 600;
        }

        .team-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .team-header h2 {
            font-size: 2rem;
            color: var(--accent-primary);
            margin-bottom: 0.5rem;
        }

        .team-header .owner {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .roster-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-card);
            border-radius: 1rem;
            overflow: hidden;
        }

        .roster-table th,
        .roster-table td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .roster-table th {
            background: var(--bg-hover);
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .roster-table th.week-col {
            text-align: center;
            min-width: 50px;
        }

        .roster-table td.week-score {
            text-align: center;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
        }

        .roster-table td.week-score.starter {
            color: var(--accent-primary);
            font-weight: 600;
        }

        .roster-table td.week-score.bench {
            color: var(--text-muted);
        }

        .roster-table .player-name {
            font-weight: 500;
        }

        .roster-table .player-team {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .roster-table .position-group {
            background: var(--bg-deep);
            font-weight: 700;
            color: var(--accent-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .roster-table .total-row {
            background: var(--bg-hover);
            font-weight: 700;
        }

        .roster-table .total-row td {
            border-bottom: none;
        }

        .roster-table .total-row .week-score {
            color: var(--accent-primary);
        }

        .roster-table th.season-col {
            background: var(--bg-deep);
            border-left: 2px solid var(--border);
        }

        .roster-table td.season-total {
            border-left: 2px solid var(--border);
            font-weight: 600;
            color: var(--text-primary);
        }

        .roster-table .total-row td:last-child {
            border-left: 2px solid var(--border);
        }

        /* Draft Picks */
        .draft-picks-section {
            margin-top: 2rem;
        }

        .draft-picks-section h3 {
            color: var(--accent-primary);
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .picks-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
        }

        @media (max-width: 900px) {
            .picks-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 500px) {
            .picks-grid {
                grid-template-columns: 1fr;
            }
        }

        .picks-season {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            padding: 1rem;
        }

        .picks-season-header {
            font-weight: 700;
            color: var(--accent-primary);
            font-size: 1.2rem;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
        }

        .picks-draft-type {
            margin-bottom: 0.75rem;
        }

        .picks-type-label {
            color: var(--text-secondary);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.25rem;
        }

        .picks-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.35rem;
        }

        .pick-item {
            padding: 0.2rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.85rem;
            font-family: 'JetBrains Mono', monospace;
        }

        .pick-item.own {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .pick-item.acquired {
            background: rgba(68, 136, 255, 0.2);
            color: var(--accent-primary);
            border: 1px solid var(--accent-primary);
        }

        .pick-from {
            color: var(--accent-tertiary);
            font-size: 0.75rem;
        }

        /* Schedule */
        .schedule-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
        }

        .schedule-week {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            padding: 1rem;
        }

        .schedule-week.rivalry {
            border-color: var(--accent-secondary);
            background: linear-gradient(135deg, rgba(221, 34, 34, 0.05), transparent);
        }

        .schedule-week.current {
            border-color: var(--accent-primary);
            background: linear-gradient(135deg, rgba(68, 136, 255, 0.05), transparent);
        }

        .schedule-week.completed {
            opacity: 0.6;
        }

        .schedule-week-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
        }

        .schedule-week-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            letter-spacing: 0.05em;
        }

        .schedule-week-title.rivalry {
            color: var(--accent-secondary);
        }

        .schedule-week-badge {
            font-size: 0.65rem;
            padding: 0.15rem 0.4rem;
            border-radius: 0.25rem;
            font-weight: 600;
        }

        .schedule-week-badge.current {
            background: var(--accent-primary);
            color: var(--bg-deep);
        }

        .schedule-week-badge.completed {
            background: var(--border);
            color: var(--text-muted);
        }

        .schedule-matchup {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.4rem 0;
            font-size: 0.85rem;
        }

        .schedule-team {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
        }

        .schedule-vs {
            color: var(--text-muted);
            font-size: 0.7rem;
        }

        .schedule-matchup.with-scores {
            justify-content: center;
            gap: 0.5rem;
        }

        .schedule-matchup.with-scores .schedule-team {
            min-width: 2.5rem;
        }

        .schedule-matchup.with-scores .schedule-team:first-child {
            text-align: right;
        }

        .schedule-matchup.with-scores .schedule-team:last-child {
            text-align: left;
        }

        .schedule-score {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            min-width: 3rem;
            text-align: center;
        }

        .schedule-score:first-of-type {
            text-align: right;
        }

        .schedule-score:last-of-type {
            text-align: left;
        }

        .schedule-team.winner,
        .schedule-score.winner {
            color: var(--accent-primary);
            font-weight: 600;
        }

        .schedule-team.loser,
        .schedule-score.loser {
            color: var(--text-muted);
        }

        /* Playoff Styles */
        .schedule-week.playoffs {
            border-color: #ffd700;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.08), rgba(255, 140, 0, 0.03));
        }

        .schedule-week.playoffs.current {
            border-width: 2px;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
        }

        .schedule-week-title.playoffs {
            color: #ffd700;
            text-transform: uppercase;
        }

        .bracket-label {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 0.9rem;
            letter-spacing: 0.1em;
            padding: 0.5rem 0 0.25rem;
            margin-top: 0.5rem;
            border-top: 1px solid var(--border);
        }

        .bracket-label:first-child {
            margin-top: 0;
            border-top: none;
            padding-top: 0;
        }

        .bracket-label.playoffs {
            color: #ffd700;
        }

        .bracket-label.championship {
            color: #ffd700;
        }

        .bracket-label.consolation_cup {
            color: #cd7f32;
        }

        .bracket-label.mid_bowl {
            color: #6b8e23;
        }

        .bracket-label.sewer_series {
            color: #708090;
        }

        .bracket-label.toilet_bowl {
            color: #a87c4f;
        }

        .playoff-matchup {
            background: rgba(255, 255, 255, 0.02);
            border-radius: 0.25rem;
            margin: 0.25rem 0;
            padding: 0.5rem !important;
        }

        .seed {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin: 0 0.25rem;
        }

        .view-container {
            display: none;
        }

        .view-container.active {
            display: block;
        }

        /* Stats Leaders */
        .stats-position-selector {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 2rem;
        }

        .stats-pos-btn {
            padding: 0.5rem 1rem;
            font-family: 'Outfit', sans-serif;
            font-weight: 600;
            font-size: 0.9rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .stats-pos-btn:hover {
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }

        .stats-pos-btn.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: var(--bg-deep);
        }

        .stats-leaders-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.5rem;
        }

        .stats-position-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            overflow: hidden;
        }

        .stats-position-header {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.3rem;
            letter-spacing: 0.1em;
            padding: 0.75rem 1rem;
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.1), rgba(0, 255, 136, 0.02));
            border-bottom: 1px solid var(--border);
            color: var(--accent-primary);
        }

        .stats-leader-row {
            display: grid;
            grid-template-columns: 2rem 1fr auto;
            align-items: center;
            padding: 0.6rem 1rem;
            gap: 0.75rem;
            border-bottom: 1px solid var(--border);
            transition: background 0.2s ease;
        }

        .stats-leader-row:last-child {
            border-bottom: none;
        }

        .stats-leader-row:hover {
            background: rgba(0, 255, 136, 0.03);
        }

        .stats-leader-row.rank-1 {
            background: linear-gradient(90deg, rgba(255, 215, 0, 0.15), transparent);
        }

        .stats-leader-row.rank-2 {
            background: linear-gradient(90deg, rgba(192, 192, 192, 0.1), transparent);
        }

        .stats-leader-row.rank-3 {
            background: linear-gradient(90deg, rgba(205, 127, 50, 0.1), transparent);
        }

        .stats-rank {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            color: var(--text-muted);
            text-align: center;
        }

        .stats-leader-row.rank-1 .stats-rank {
            color: #ffd700;
        }

        .stats-leader-row.rank-2 .stats-rank {
            color: #c0c0c0;
        }

        .stats-leader-row.rank-3 .stats-rank {
            color: #cd7f32;
        }

        .stats-player-info {
            display: flex;
            flex-direction: column;
            gap: 0.15rem;
            min-width: 0;
        }

        .stats-player-name {
            font-weight: 600;
            font-size: 0.95rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .stats-player-meta {
            display: flex;
            gap: 0.5rem;
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .stats-nfl-team {
            font-family: 'JetBrains Mono', monospace;
            color: var(--accent-secondary);
        }

        .stats-fantasy-team {
            opacity: 0.8;
        }

        .stats-points {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1rem;
            font-weight: 600;
            color: var(--accent-primary);
            text-align: right;
        }

        .stats-view-all {
            display: block;
            text-align: center;
            padding: 0.75rem;
            font-size: 0.85rem;
            color: var(--accent-primary);
            background: transparent;
            border: none;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .stats-view-all:hover {
            background: rgba(0, 255, 136, 0.05);
        }

        /* Page titles */
        .page-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2.5rem;
            letter-spacing: 0.1em;
            text-align: center;
            margin-bottom: 2rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-tertiary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Banner Room */
        .banners-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            justify-items: center;
        }

        .banner-item {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 1rem;
            padding: 1rem;
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .banner-item:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 40px rgba(68, 136, 255, 0.1);
        }

        .banner-item img {
            max-width: 100%;
            height: auto;
            border-radius: 0.5rem;
        }

        /* Hall of Fame */
        .hof-content {
            max-width: 900px;
            margin: 0 auto;
        }

        .hof-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .hof-section-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.5rem;
            letter-spacing: 0.05em;
            color: var(--accent-primary);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
        }

        .hof-year {
            margin-bottom: 1.5rem;
        }

        .hof-year-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.3rem;
            color: var(--accent-tertiary);
            margin-bottom: 0.5rem;
        }

        .hof-year-results {
            padding-left: 1rem;
        }

        .hof-year-results li {
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
        }

        .hof-year-results li:first-child {
            color: #ffd700;
            font-weight: 600;
        }

        .hof-year-results li:nth-child(2) {
            color: #c0c0c0;
        }

        .hof-year-results li:nth-child(3) {
            color: #cd7f32;
        }

        .owner-stats-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .owner-stats-table th {
            text-align: left;
            padding: 0.75rem 0.5rem;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            border-bottom: 1px solid var(--border);
        }

        .owner-stats-table td {
            padding: 0.75rem 0.5rem;
            border-bottom: 1px solid var(--border);
        }

        .owner-stats-table tr:hover {
            background: var(--bg-hover);
        }

        .rings {
            color: #ffd700;
        }

        .record-item {
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            color: var(--text-secondary);
        }

        .record-item:last-child {
            border-bottom: none;
        }

        .record-subsection {
            margin-top: 1rem;
        }

        .record-subsection-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        /* Constitution */
        .constitution-content {
            max-width: 800px;
            margin: 0 auto;
        }

        .constitution-article {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .article-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.5rem;
            letter-spacing: 0.05em;
            color: var(--accent-primary);
            margin-bottom: 1rem;
        }

        .article-section {
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-weight: 600;
            color: var(--accent-tertiary);
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .section-content {
            padding-left: 1rem;
            color: var(--text-secondary);
        }

        .section-content p {
            margin-bottom: 0.5rem;
        }

        .section-subheader {
            font-weight: 600;
            color: var(--text-primary);
            margin-top: 0.75rem;
            margin-bottom: 0.25rem;
        }

        .content-header {
            color: var(--accent-tertiary);
            font-weight: 500;
            margin-top: 0.75rem;
            margin-bottom: 0.25rem;
        }

        .content-item {
            color: var(--text-secondary);
            margin-left: 1.5rem;
            margin-bottom: 0.35rem;
            line-height: 1.5;
        }

        .content-subitem {
            color: var(--text-muted);
            margin-left: 3rem;
            margin-bottom: 0.25rem;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .item-num {
            color: var(--accent-primary);
            font-weight: 600;
            margin-right: 0.5rem;
            font-family: 'JetBrains Mono', monospace;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .logo {
                font-size: 1.5rem;
                letter-spacing: 0.05em;
            }

            .matchup-header {
                grid-template-columns: 1fr;
                text-align: center;
                gap: 1rem;
            }

            .team, .team.right {
                text-align: center;
            }

            .roster-grid {
                grid-template-columns: 1fr;
            }

            .standings-table th,
            .standings-table td {
                padding: 0.5rem;
                font-size: 0.8rem;
            }
        }

        /* Transactions */
        .transactions-season-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            justify-content: center;
        }

        .season-btn {
            padding: 0.5rem 1.25rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.95rem;
            font-weight: 500;
        }

        .season-btn:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
            border-color: var(--accent-primary);
        }

        .season-btn.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: var(--bg-deep);
            font-weight: 600;
        }

        .transactions-content {
            max-width: 900px;
            margin: 0 auto;
        }

        .transactions-season {
            margin-bottom: 2rem;
        }

        .transactions-week {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            margin-bottom: 1rem;
            overflow: hidden;
        }

        .transactions-week-header {
            background: var(--bg-hover);
            padding: 0.75rem 1rem;
            font-weight: 600;
            color: var(--accent-tertiary);
            border-bottom: 1px solid var(--border);
        }

        .transaction-item {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .transaction-item:last-child {
            border-bottom: none;
        }

        .transaction-title {
            color: var(--text-primary);
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .transaction-details {
            padding-left: 1rem;
        }

        .transaction-subheader {
            color: var(--accent-tertiary);
            font-weight: 500;
            margin-top: 0.5rem;
            margin-bottom: 0.25rem;
        }

        .transaction-list-item {
            color: var(--text-secondary);
            margin-left: 1rem;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        /* Lineup Form Styles */
        .lineup-form-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .auth-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 1rem;
            padding: 2rem;
            max-width: 400px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .auth-card h3 {
            text-align: center;
            color: var(--accent-primary);
            margin-bottom: 0.5rem;
        }

        .lineup-select, .lineup-input {
            padding: 0.75rem 1rem;
            font-family: 'Outfit', sans-serif;
            font-size: 1rem;
            background: var(--bg-deep);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            color: var(--text-primary);
            transition: border-color 0.2s;
        }

        .lineup-select:focus, .lineup-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .lineup-btn {
            padding: 0.75rem 1.5rem;
            font-family: 'Outfit', sans-serif;
            font-weight: 600;
            font-size: 0.95rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .lineup-btn.primary {
            background: var(--accent-primary);
            color: var(--bg-deep);
        }

        .lineup-btn.primary:hover {
            background: var(--accent-tertiary);
            transform: translateY(-1px);
        }

        .lineup-btn.primary:disabled {
            background: var(--text-muted);
            cursor: not-allowed;
            transform: none;
        }

        .lineup-btn.secondary {
            background: var(--bg-hover);
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }

        .lineup-btn.secondary:hover {
            color: var(--text-primary);
            border-color: var(--accent-primary);
        }

        .lineup-btn.large {
            padding: 1rem 2rem;
            font-size: 1.1rem;
        }

        .lineup-error {
            color: var(--accent-secondary);
            font-size: 0.9rem;
            text-align: center;
            min-height: 1.2rem;
        }

        .editor-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .editor-header h3 {
            color: var(--text-primary);
            font-size: 1.5rem;
            margin: 0;
        }

        .week-badge {
            background: var(--accent-primary);
            color: var(--bg-deep);
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .lineup-instructions {
            background: rgba(68, 136, 255, 0.1);
            border: 1px solid rgba(68, 136, 255, 0.3);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1.5rem;
            color: var(--text-secondary);
        }

        .position-groups {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .position-group-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            overflow: hidden;
        }

        .position-group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            background: var(--bg-hover);
            border-bottom: 1px solid var(--border);
        }

        .position-label {
            font-weight: 700;
            color: var(--accent-tertiary);
            font-size: 1rem;
        }

        .starter-count {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .starter-count.complete {
            color: var(--win);
        }

        .starter-count.incomplete {
            color: var(--accent-secondary);
        }

        .player-options {
            display: flex;
            flex-direction: column;
        }

        .player-option {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: all 0.15s;
            border-bottom: 1px solid var(--border);
        }

        .player-option:last-child {
            border-bottom: none;
        }

        .player-option:hover {
            background: var(--bg-hover);
        }

        .player-option.selected {
            background: rgba(68, 136, 255, 0.15);
            border-left: 3px solid var(--accent-primary);
        }

        .player-option .starter-indicator {
            width: 24px;
            height: 24px;
            border: 2px solid var(--border);
            border-radius: 50%;
            margin-right: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
        }

        .player-option.selected .starter-indicator {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
        }

        .player-option.selected .starter-indicator::after {
            content: 'âœ“';
            color: var(--bg-deep);
            font-weight: bold;
            font-size: 0.8rem;
        }

        .player-option .player-details {
            flex: 1;
        }

        .player-option .player-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .player-option .player-team {
            color: var(--text-muted);
            font-size: 0.85rem;
            margin-left: 0.5rem;
        }

        .lineup-actions {
            margin-top: 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }

        .lineup-summary {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .lineup-summary.valid {
            color: var(--win);
        }

        .lineup-summary.invalid {
            color: var(--accent-secondary);
        }

        .submit-status {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 0.5rem;
            text-align: center;
            font-weight: 500;
        }

        .submit-status.success {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid var(--win);
            color: var(--win);
        }

        .submit-status.error {
            background: rgba(255, 51, 102, 0.1);
            border: 1px solid var(--accent-secondary);
            color: var(--accent-secondary);
        }

        .submit-status.loading {
            background: rgba(68, 136, 255, 0.1);
            border: 1px solid var(--accent-primary);
            color: var(--accent-primary);
        }

        .submit-status:empty {
            display: none;
        }

        /* Locked player styling */
        .player-option.locked {
            opacity: 0.7;
            cursor: not-allowed;
            background: rgba(255, 170, 0, 0.1);
        }

        .player-option.locked .starter-indicator {
            border-color: var(--tie);
            background: rgba(255, 170, 0, 0.2);
            font-size: 0.7rem;
        }

        .player-option.locked.selected {
            background: rgba(255, 170, 0, 0.15);
            border-left: 3px solid var(--tie);
        }

        .locked-label {
            display: inline-block;
            margin-left: 0.5rem;
            padding: 0.1rem 0.4rem;
            font-size: 0.7rem;
            font-weight: 600;
            background: var(--tie);
            color: var(--bg-deep);
            border-radius: 0.25rem;
        }

        /* Manage Roster / Transaction Styles */
        .manage-container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .manage-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .manage-header h3 {
            margin: 0;
            font-size: 1.25rem;
        }

        .transaction-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            border-bottom: 2px solid var(--border);
            padding-bottom: 0.5rem;
        }

        .tx-tab {
            padding: 0.6rem 1.25rem;
            font-family: 'Outfit', sans-serif;
            font-weight: 500;
            font-size: 0.9rem;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 0.5rem 0.5rem 0 0;
            position: relative;
        }

        .tx-tab:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .tx-tab.active {
            background: var(--bg-card);
            color: var(--accent-primary);
            font-weight: 600;
        }

        .tx-tab.active::after {
            content: '';
            position: absolute;
            bottom: -0.5rem;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--accent-primary);
        }

        .tx-content {
            display: none;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 1rem;
            padding: 1.5rem;
        }

        .tx-content.active {
            display: block;
        }

        .tx-description {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: var(--bg-deep);
            border-radius: 0.5rem;
            color: var(--text-secondary);
        }

        .tx-description p {
            margin: 0 0 0.5rem 0;
        }

        .tx-description p:last-child {
            margin-bottom: 0;
        }

        .deadline-warning {
            color: var(--accent-secondary) !important;
            font-weight: 600;
        }

        .tx-section {
            margin-bottom: 1.5rem;
        }

        .tx-section h4 {
            margin: 0 0 0.75rem 0;
            font-size: 1rem;
            color: var(--text-primary);
        }

        .player-list {
            display: grid;
            gap: 0.5rem;
        }

        .tx-player {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            background: var(--bg-deep);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .tx-player:hover {
            background: var(--bg-hover);
            border-color: var(--accent-tertiary);
        }

        .tx-player.selected {
            background: rgba(68, 136, 255, 0.15);
            border-color: var(--accent-primary);
            border-left: 3px solid var(--accent-primary);
        }

        .tx-player.unavailable {
            opacity: 0.5;
            cursor: not-allowed;
            text-decoration: line-through;
        }

        .tx-player .position-tag {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            background: var(--accent-tertiary);
            color: var(--bg-deep);
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
            min-width: 40px;
            text-align: center;
            margin-right: 0.75rem;
        }

        .tx-player .player-name {
            flex: 1;
            font-weight: 500;
        }

        .tx-player .player-team {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .tx-actions {
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .tx-summary {
            flex: 1;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Trade-specific styles */
        .trade-columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1rem;
        }

        @media (max-width: 768px) {
            .trade-columns {
                grid-template-columns: 1fr;
            }
        }

        .trade-column {
            background: var(--bg-deep);
            border-radius: 0.75rem;
            padding: 1rem;
        }

        .trade-column h4 {
            margin: 0 0 1rem 0;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
        }

        .trade-subsection {
            margin-bottom: 1rem;
        }

        .trade-subsection h5 {
            margin: 0 0 0.5rem 0;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .pick-list {
            display: grid;
            gap: 0.5rem;
        }

        .tx-pick {
            display: flex;
            align-items: center;
            padding: 0.5rem 0.75rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        .tx-pick:hover {
            border-color: var(--accent-tertiary);
        }

        .tx-pick.selected {
            background: rgba(68, 136, 255, 0.15);
            border-color: var(--accent-primary);
        }

        /* Pending trades */
        .pending-trades-list {
            display: grid;
            gap: 1rem;
        }

        .pending-trade-card {
            background: var(--bg-deep);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            padding: 1.25rem;
        }

        .pending-trade-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .pending-trade-teams {
            font-weight: 600;
            font-size: 1rem;
        }

        .pending-trade-date {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .pending-trade-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .pending-trade-side h5 {
            margin: 0 0 0.5rem 0;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .pending-trade-side ul {
            margin: 0;
            padding-left: 1.25rem;
        }

        .pending-trade-actions {
            display: flex;
            gap: 0.75rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }

        .pending-trade-actions button {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }

        .accept-btn {
            background: var(--win);
            color: var(--bg-deep);
        }

        .reject-btn {
            background: var(--accent-secondary);
            color: white;
        }

        .pending-status-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .pending-status-badge.pending {
            background: var(--tie);
            color: var(--bg-deep);
        }

        .pending-status-badge.accepted {
            background: var(--win);
            color: var(--bg-deep);
        }

        .pending-status-badge.rejected {
            background: var(--accent-secondary);
            color: white;
        }

        .no-pending-trades {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
        }

        /* Hall of Fame sub-navigation */
        .hof-subnav {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .hof-subnav-btn {
            padding: 0.5rem 1.25rem;
            font-family: 'Outfit', sans-serif;
            font-weight: 500;
            font-size: 0.85rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            border-radius: 2rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .hof-subnav-btn:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
            border-color: var(--accent-tertiary);
        }

        .hof-subnav-btn.active {
            background: var(--accent-tertiary);
            border-color: var(--accent-tertiary);
            color: var(--bg-deep);
            font-weight: 600;
        }

        .hof-subview {
            display: none;
        }

        .hof-subview.active {
            display: block;
        }

        /* Taxi Squad Styles */
        .taxi-squad-section {
            margin-top: 2rem;
            padding: 1.5rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
        }

        .taxi-squad-section h3 {
            color: var(--accent-tertiary);
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .taxi-description {
            color: var(--text-muted);
            font-size: 0.85rem;
            margin-bottom: 1rem;
            font-style: italic;
        }

        .taxi-players {
            display: grid;
            gap: 0.5rem;
        }

        .taxi-player {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.5rem 0.75rem;
            background: var(--bg-hover);
            border-radius: 0.5rem;
            border-left: 3px solid var(--text-muted);
        }

        .taxi-position {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-muted);
            background: var(--bg-deep);
            padding: 0.2rem 0.5rem;
            border-radius: 0.25rem;
            min-width: 3rem;
            text-align: center;
        }

        .taxi-name {
            flex: 1;
            color: var(--text-secondary);
        }

        .taxi-team {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            color: var(--text-muted);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <img src="images/league_logo.png" alt="QPFL Logo" class="league-logo">
            <div class="logo">Quarantine Perennial Football League</div>
            <div class="season-badge" id="season-badge">2025 Season</div>
            <div class="updated" id="updated-time">Loading...</div>
        </header>

        <nav>
            <button class="nav-btn active" data-view="matchups">Matchups</button>
            <button class="nav-btn" data-view="standings">Standings</button>
            <button class="nav-btn" data-view="teams">Teams</button>
            <button class="nav-btn" data-view="schedule">Schedule</button>
            <button class="nav-btn" data-view="stats">Stats Leaders</button>
            <button class="nav-btn" data-view="hof">Hall of Fame</button>
            <button class="nav-btn" data-view="transactions">Transactions</button>
            <button class="nav-btn" data-view="manage">Manage Rosters</button>
        </nav>

        <div id="matchups-view" class="view-container active">
            <div class="week-selector" id="week-selector"></div>
            <div class="matchups" id="matchups-container"></div>
        </div>

        <div id="standings-view" class="view-container">
            <table class="standings-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Team</th>
                        <th class="num">Rank Pts</th>
                        <th class="num">Record</th>
                        <th class="num">Top 5</th>
                        <th class="num">PF</th>
                        <th class="num">PA</th>
                    </tr>
                </thead>
                <tbody id="standings-body"></tbody>
            </table>
        </div>

        <div id="teams-view" class="view-container">
            <div class="team-selector" id="team-selector"></div>
            <div class="team-roster" id="team-roster-container"></div>
        </div>

        <div id="schedule-view" class="view-container">
            <div class="schedule-grid" id="schedule-container"></div>
        </div>

        <div id="stats-view" class="view-container">
            <div class="page-title">Stats Leaders</div>
            <div class="stats-position-selector" id="stats-position-selector"></div>
            <div class="stats-leaders-container" id="stats-leaders-container"></div>
        </div>

        <div id="hof-view" class="view-container">
            <div class="page-title">Hall of Fame</div>
            <div class="hof-subnav">
                <button class="hof-subnav-btn active" data-subview="records">Records</button>
                <button class="hof-subnav-btn" data-subview="banners">Banner Room</button>
                <button class="hof-subnav-btn" data-subview="constitution">Constitution</button>
            </div>
            <div class="hof-subview active" id="hof-records-subview">
                <div class="hof-content" id="hof-container"></div>
            </div>
            <div class="hof-subview" id="hof-banners-subview">
                <div class="banners-grid" id="banners-container"></div>
            </div>
            <div class="hof-subview" id="hof-constitution-subview">
                <div class="constitution-content" id="constitution-container"></div>
            </div>
        </div>

        <div id="transactions-view" class="view-container">
            <div class="page-title">Transaction Log</div>
            <div class="transactions-season-selector" id="transactions-season-selector"></div>
            <div class="transactions-content" id="transactions-container"></div>
        </div>

        <div id="manage-view" class="view-container">
            <div class="page-title">Manage Rosters</div>
            <div class="manage-container">
                <!-- Auth Section -->
                <div class="manage-auth" id="manage-auth">
                    <div class="auth-card">
                        <h3>Select Your Team</h3>
                        <select id="manage-team-select" class="lineup-select">
                            <option value="">-- Choose Team --</option>
                        </select>
                        <input type="password" id="manage-password" class="lineup-input" placeholder="Enter team password">
                        <button id="manage-login-btn" class="lineup-btn primary">Login</button>
                        <div id="manage-error" class="lineup-error"></div>
                    </div>
                </div>

                <!-- Transaction Tabs -->
                <div class="manage-panel" id="manage-panel" style="display: none;">
                    <div class="manage-header">
                        <h3 id="manage-team-name"></h3>
                        <button id="manage-logout-btn" class="lineup-btn secondary">â† Logout</button>
                    </div>
                    
                    <div class="transaction-tabs">
                        <button class="tx-tab active" data-tab="lineup">Set Lineup</button>
                        <button class="tx-tab" data-tab="taxi">Taxi Squad</button>
                        <button class="tx-tab" data-tab="fa">Free Agents</button>
                        <button class="tx-tab" data-tab="trade">Propose Trade</button>
                        <button class="tx-tab" data-tab="pending">Pending Trades</button>
                    </div>

                    <!-- Set Lineup Tab -->
                    <div class="tx-content active" id="tx-lineup">
                        <div class="tx-description">
                            <p>Set your starting lineup for each week. Select one player per position (two for RB and WR).</p>
                        </div>
                        <div class="tx-section">
                            <h4>Select Week</h4>
                            <select id="lineup-week-select" class="lineup-select" style="margin-bottom: 1rem;">
                                <option value="">-- Select Week --</option>
                            </select>
                        </div>
                        <div class="lineup-editor" id="lineup-editor" style="display: none;">
                            <div class="editor-header">
                                <span id="editor-week-label" class="week-badge"></span>
                            </div>
                            <div class="lineup-instructions">
                                <p>Select <strong>one starter</strong> for each position slot. Click on a player to toggle their starting status.</p>
                            </div>
                            <div class="position-groups" id="position-groups"></div>
                            <div class="lineup-actions">
                                <div class="lineup-summary" id="lineup-summary"></div>
                                <button id="lineup-submit-btn" class="lineup-btn primary large">Submit Lineup</button>
                            </div>
                            <div id="submit-status" class="submit-status"></div>
                        </div>
                    </div>

                    <!-- Taxi Activation Tab -->
                    <div class="tx-content" id="tx-taxi">
                        <div class="tx-description">
                            <p>Activate a player from your taxi squad to your active roster. You must release a player at the same position.</p>
                        </div>
                        <div class="tx-section">
                            <h4>Your Taxi Squad</h4>
                            <div id="taxi-players" class="player-list"></div>
                        </div>
                        <div class="tx-section" id="taxi-release-section" style="display: none;">
                            <h4>Select Player to Release</h4>
                            <div id="taxi-release-players" class="player-list"></div>
                        </div>
                        <div class="tx-actions" id="taxi-actions" style="display: none;">
                            <div class="tx-summary" id="taxi-summary"></div>
                            <button id="taxi-submit-btn" class="lineup-btn primary">Confirm Activation</button>
                        </div>
                        <div id="taxi-status" class="submit-status"></div>
                    </div>

                    <!-- FA Pool Tab -->
                    <div class="tx-content" id="tx-fa">
                        <div class="tx-description">
                            <p>Add a player from the free agent pool. You must release a player at the same position.</p>
                        </div>
                        <div class="tx-section">
                            <h4>Available Free Agents</h4>
                            <div id="fa-players" class="player-list"></div>
                        </div>
                        <div class="tx-section" id="fa-release-section" style="display: none;">
                            <h4>Select Player to Release</h4>
                            <div id="fa-release-players" class="player-list"></div>
                        </div>
                        <div class="tx-actions" id="fa-actions" style="display: none;">
                            <div class="tx-summary" id="fa-summary"></div>
                            <button id="fa-submit-btn" class="lineup-btn primary">Confirm Pickup</button>
                        </div>
                        <div id="fa-status" class="submit-status"></div>
                    </div>

                    <!-- Trade Proposal Tab -->
                    <div class="tx-content" id="tx-trade">
                        <div class="tx-description">
                            <p>Propose a trade with another team. Both teams must approve for the trade to execute.</p>
                            <p class="deadline-warning" id="trade-deadline-warning"></p>
                        </div>
                        <div class="tx-section">
                            <h4>Trade Partner</h4>
                            <select id="trade-partner-select" class="lineup-select">
                                <option value="">-- Select Team --</option>
                            </select>
                        </div>
                        <div class="trade-columns">
                            <div class="trade-column">
                                <h4>You Give</h4>
                                <div class="trade-subsection">
                                    <h5>Players</h5>
                                    <div id="trade-give-players" class="player-list"></div>
                                </div>
                                <div class="trade-subsection">
                                    <h5>Draft Picks</h5>
                                    <div id="trade-give-picks" class="pick-list"></div>
                                </div>
                            </div>
                            <div class="trade-column">
                                <h4>You Receive</h4>
                                <div class="trade-subsection">
                                    <h5>Players</h5>
                                    <div id="trade-receive-players" class="player-list"></div>
                                </div>
                                <div class="trade-subsection">
                                    <h5>Draft Picks</h5>
                                    <div id="trade-receive-picks" class="pick-list"></div>
                                </div>
                            </div>
                        </div>
                        <div class="tx-actions">
                            <button id="trade-submit-btn" class="lineup-btn primary">Propose Trade</button>
                        </div>
                        <div id="trade-status" class="submit-status"></div>
                    </div>

                    <!-- Pending Trades Tab -->
                    <div class="tx-content" id="tx-pending">
                        <div class="tx-description">
                            <p>Trades waiting for your approval or pending with other teams.</p>
                        </div>
                        <div id="pending-trades" class="pending-trades-list"></div>
                        <div id="pending-status" class="submit-status"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let data = null;
        let currentWeek = 1;

        async function loadData() {
            try {
                const response = await fetch('data.json');
                data = await response.json();
                currentWeek = data.current_week;
                render();
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('updated-time').textContent = 'Error loading scores';
            }
        }

        function formatDate(isoString) {
            const date = new Date(isoString);
            return date.toLocaleString('en-US', {
                weekday: 'short',
                month: 'short',
                day: 'numeric',
                hour: 'numeric',
                minute: '2-digit',
                timeZoneName: 'short'
            });
        }

        function render() {
            document.getElementById('season-badge').textContent = `${data.season} Season`;
            document.getElementById('updated-time').textContent = `Last updated: ${formatDate(data.updated_at)}`;
            
            renderWeekSelector();
            renderMatchups();
            renderStandings();
            renderTeams();
            renderSchedule();
            renderStatsLeaders();
            renderBanners();
            renderHallOfFame();
            renderTransactions();
            renderConstitution();
        }

        function renderWeekSelector() {
            const container = document.getElementById('week-selector');
            
            // Collect all weeks from both weeks data and schedule (for playoffs)
            const allWeeks = new Set(data.weeks.map(w => w.week));
            if (data.schedule) {
                data.schedule.forEach(w => allWeeks.add(w.week));
            }
            const weekNumbers = Array.from(allWeeks).sort((a, b) => a - b);
            
            container.innerHTML = `
                <span class="week-label">WEEK</span>
                ${weekNumbers.map(weekNum => {
                    const scheduleWeek = data.schedule?.find(w => w.week === weekNum);
                    const isPlayoffs = scheduleWeek?.is_playoffs;
                    const playoffClass = isPlayoffs ? 'playoff' : '';
                    return `
                        <button class="week-btn ${weekNum === currentWeek ? 'active' : ''} ${playoffClass}" 
                                data-week="${weekNum}">${weekNum}</button>
                    `;
                }).join('')}
            `;

            container.querySelectorAll('.week-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    currentWeek = parseInt(btn.dataset.week);
                    renderWeekSelector();
                    renderMatchups();
                });
            });
        }

        function renderMatchups() {
            const weekData = data.weeks.find(w => w.week === currentWeek);
            const scheduleWeek = data.schedule?.find(w => w.week === currentWeek);
            const container = document.getElementById('matchups-container');
            
            // If no week data exists, show the schedule matchups (for playoffs or upcoming weeks)
            if (!weekData || !weekData.matchups || weekData.matchups.length === 0) {
                if (scheduleWeek && scheduleWeek.matchups) {
                    const isPlayoffs = scheduleWeek.is_playoffs;
                    const playoffRound = scheduleWeek.playoff_round || '';
                    
                    // Group matchups by bracket for playoffs
                    const bracketLabels = {
                        'playoffs': 'ðŸ† Playoffs',
                        'championship': 'ðŸ† Championship',
                        'consolation_cup': 'ðŸ¥‰ Consolation Cup',
                        'mid_bowl': 'ðŸ¥£ Mid Bowl',
                        'sewer_series': 'ðŸš¿ Sewer Series',
                        'toilet_bowl': 'ðŸš½ Toilet Bowl'
                    };
                    
                    let matchupsHtml = '';
                    
                    if (isPlayoffs) {
                        // Group by bracket
                        const matchupsByBracket = {};
                        scheduleWeek.matchups.forEach(m => {
                            const bracket = m.bracket || 'other';
                            if (!matchupsByBracket[bracket]) matchupsByBracket[bracket] = [];
                            matchupsByBracket[bracket].push(m);
                        });
                        
                        const bracketOrder = ['playoffs', 'championship', 'consolation_cup', 'mid_bowl', 'sewer_series', 'toilet_bowl', 'other'];
                        matchupsHtml = bracketOrder
                            .filter(bracket => matchupsByBracket[bracket])
                            .map(bracket => {
                                const label = bracketLabels[bracket] || '';
                                return `
                                    ${label ? `<div class="playoff-bracket-header ${bracket}">${label}</div>` : ''}
                                    ${matchupsByBracket[bracket].map(m => {
                                        const seed1 = m.seed1 ? `<span class="matchup-seed">#${m.seed1}</span>` : '';
                                        const seed2 = m.seed2 ? `<span class="matchup-seed">#${m.seed2}</span>` : '';
                                        return `
                                            <div class="matchup-card pending playoff">
                                                <div class="matchup-header">
                                                    <div class="team">
                                                        ${seed1}
                                                        <div class="team-name">${m.team1}</div>
                                                    </div>
                                                    <div class="vs-container">
                                                        <span class="vs-text">vs</span>
                                                    </div>
                                                    <div class="team right">
                                                        <div class="team-name">${m.team2}</div>
                                                        ${seed2}
                                                    </div>
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                                `;
                            }).join('');
                    } else {
                        matchupsHtml = scheduleWeek.matchups.map(m => `
                            <div class="matchup-card pending">
                                <div class="matchup-header">
                                    <div class="team">
                                        <div class="team-name">${m.team1}</div>
                                    </div>
                                    <div class="vs-container">
                                        <span class="vs-text">vs</span>
                                    </div>
                                    <div class="team right">
                                        <div class="team-name">${m.team2}</div>
                                    </div>
                                </div>
                            </div>
                        `).join('');
                    }
                    
                    const headerText = isPlayoffs 
                        ? `<span class="playoff-round-badge">${playoffRound}</span> Scores not yet available`
                        : `Scores not yet available for Week ${currentWeek}`;
                    
                    container.innerHTML = `
                        <div class="no-scores-message ${isPlayoffs ? 'playoffs' : ''}">
                            <p>${headerText}</p>
                        </div>
                        ${matchupsHtml}
                    `;
                } else {
                    container.innerHTML = '<div class="no-scores-message"><p>Matchups not available for Week ' + currentWeek + '</p></div>';
                }
                return;
            }
            
            container.innerHTML = weekData.matchups.map((matchup, idx) => {
                const t1 = matchup.team1;
                const t2 = matchup.team2;
                const t1Winning = t1.total_score > t2.total_score;
                const t2Winning = t2.total_score > t1.total_score;

                return `
                    <div class="matchup-card">
                        <div class="matchup-header">
                            <div class="team">
                                <div class="team-name">${t1.name}</div>
                                <div class="team-owner">${t1.owner}</div>
                            </div>
                            <div class="vs-container">
                                <div class="score-display">
                                    <span class="score ${t1Winning ? 'winning' : 'losing'}">${t1.total_score.toFixed(0)}</span>
                                    <span class="score-divider">â€”</span>
                                    <span class="score ${t2Winning ? 'winning' : 'losing'}">${t2.total_score.toFixed(0)}</span>
                                </div>
                            </div>
                            <div class="team right">
                                <div class="team-name">${t2.name}</div>
                                <div class="team-owner">${t2.owner}</div>
                            </div>
                        </div>
                        <button class="expand-btn" data-matchup="${idx}">Show Rosters â–¼</button>
                        <div class="roster-panel" id="roster-${idx}">
                            <div class="roster-grid">
                                <div class="roster-column">
                                    <h4>${t1.abbrev}</h4>
                                    ${renderRoster(t1.roster)}
                                </div>
                                <div class="roster-column">
                                    <h4>${t2.abbrev}</h4>
                                    ${renderRoster(t2.roster)}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            // Add expand/collapse functionality
            container.querySelectorAll('.expand-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const panel = document.getElementById(`roster-${btn.dataset.matchup}`);
                    const isExpanded = panel.classList.toggle('expanded');
                    btn.textContent = isExpanded ? 'Hide Rosters â–²' : 'Show Rosters â–¼';
                });
            });
        }

        function renderRoster(roster) {
            // Sort: starters first by position order, then bench
            const posOrder = ['QB', 'RB', 'WR', 'TE', 'K', 'D/ST', 'HC', 'OL'];
            const sorted = [...roster].sort((a, b) => {
                if (a.starter !== b.starter) return b.starter - a.starter;
                return posOrder.indexOf(a.position) - posOrder.indexOf(b.position);
            });

            return sorted.map(p => `
                <div class="player-row ${p.starter ? '' : 'bench'}">
                    <div class="player-info">
                        <span class="position-tag">${p.position}</span>
                        <span class="player-name">${p.name}</span>
                        <span class="player-team">${p.nfl_team}</span>
                    </div>
                    <span class="player-score">${p.score.toFixed(0)}</span>
                </div>
            `).join('');
        }

        function renderStandings() {
            const tbody = document.getElementById('standings-body');
            const totalTeams = data.standings.length;
            
            tbody.innerHTML = data.standings.map((team, idx) => {
                const rank = idx + 1;
                const isPlayoffs = rank <= 4;
                const isToiletBowl = rank > totalTeams - 4;
                const rankClass = isPlayoffs ? 'playoffs' : (isToiletBowl ? 'toilet-bowl' : '');
                const label = isPlayoffs ? '<span class="playoff-label playoffs">Playoffs</span>' : 
                              (isToiletBowl ? '<span class="playoff-label toilet">Toilet Bowl</span>' : '');
                
                return `
                    <tr>
                        <td class="rank ${rankClass}">${rank}</td>
                        <td>
                            <div class="team-name">${team.name}<span class="team-code">${team.abbrev}</span>${label}</div>
                            <div class="team-owner">${team.owner}</div>
                        </td>
                        <td class="num rank-points">${team.rank_points.toFixed(1)}</td>
                        <td class="num record">${team.wins}-${team.losses}${team.ties ? `-${team.ties}` : ''}</td>
                        <td class="num top-half">${team.top_half || 0}</td>
                        <td class="num points-for">${team.points_for.toFixed(1)}</td>
                        <td class="num points-against">${team.points_against.toFixed(1)}</td>
                    </tr>
                `;
            }).join('');
        }

        function renderSchedule() {
            if (!data.schedule) return;
            
            // Build a lookup for week scores from the weeks data
            const weekScores = {};
            if (data.weeks) {
                data.weeks.forEach(week => {
                    if (week.has_scores) {
                        weekScores[week.week] = {};
                        week.matchups.forEach(matchup => {
                            // Calculate total from starter scores
                            const team1Total = matchup.team1.roster
                                .filter(p => p.starter)
                                .reduce((sum, p) => sum + p.score, 0);
                            const team2Total = matchup.team2.roster
                                .filter(p => p.starter)
                                .reduce((sum, p) => sum + p.score, 0);
                            weekScores[week.week][matchup.team1.abbrev] = team1Total;
                            weekScores[week.week][matchup.team2.abbrev] = team2Total;
                        });
                    }
                });
            }
            
            const container = document.getElementById('schedule-container');
            container.innerHTML = data.schedule.map(week => {
                const isCurrent = week.week === data.current_week;
                const hasScores = weekScores[week.week];
                const isCompleted = hasScores !== undefined;
                const isRivalry = week.is_rivalry;
                const isPlayoffs = week.is_playoffs;
                
                const cardClasses = [
                    'schedule-week',
                    isRivalry ? 'rivalry' : '',
                    isPlayoffs ? 'playoffs' : '',
                    isCurrent ? 'current' : '',
                    isCompleted ? 'completed' : ''
                ].filter(Boolean).join(' ');
                
                const badge = isCurrent ? '<span class="schedule-week-badge current">Current</span>' :
                              (isCompleted ? '<span class="schedule-week-badge completed">Done</span>' : '');
                
                let weekTitle = isRivalry ? `Rivalry Week` : `Week ${week.week}`;
                if (isPlayoffs) {
                    weekTitle = week.playoff_round || `Playoffs Week ${week.week}`;
                }
                const titleClass = isRivalry ? 'rivalry' : (isPlayoffs ? 'playoffs' : '');
                
                // Group playoff matchups by bracket
                const matchupsByBracket = {};
                if (isPlayoffs) {
                    week.matchups.forEach(m => {
                        const bracket = m.bracket || 'other';
                        if (!matchupsByBracket[bracket]) {
                            matchupsByBracket[bracket] = [];
                        }
                        matchupsByBracket[bracket].push(m);
                    });
                }
                
                const bracketLabels = {
                    'playoffs': 'ðŸ† Playoffs',
                    'championship': 'ðŸ† Championship',
                    'consolation_cup': 'ðŸ¥‰ Consolation Cup',
                    'mid_bowl': 'ðŸ¥£ Mid Bowl',
                    'sewer_series': 'ðŸš¿ Sewer Series',
                    'toilet_bowl': 'ðŸš½ Toilet Bowl'
                };
                
                const renderMatchup = (m) => {
                    const team1 = m.team1;
                    const team2 = m.team2;
                    const score1 = hasScores ? weekScores[week.week]?.[team1] : undefined;
                    const score2 = hasScores ? weekScores[week.week]?.[team2] : undefined;
                    
                    // Show seed info for playoff matchups
                    const seed1 = m.seed1 ? `<span class="seed">#${m.seed1}</span>` : '';
                    const seed2 = m.seed2 ? `<span class="seed">#${m.seed2}</span>` : '';
                    
                    if (score1 !== undefined && score2 !== undefined) {
                        const winner1 = score1 > score2 ? 'winner' : (score1 < score2 ? 'loser' : '');
                        const winner2 = score2 > score1 ? 'winner' : (score2 < score1 ? 'loser' : '');
                        return `
                            <div class="schedule-matchup with-scores ${isPlayoffs ? 'playoff-matchup' : ''}">
                                ${seed1}<span class="schedule-team ${winner1}">${team1}</span>
                                <span class="schedule-score ${winner1}">${score1.toFixed(0)}</span>
                                <span class="schedule-vs">-</span>
                                <span class="schedule-score ${winner2}">${score2.toFixed(0)}</span>
                                <span class="schedule-team ${winner2}">${team2}</span>${seed2}
                            </div>
                        `;
                    }
                    return `
                        <div class="schedule-matchup ${isPlayoffs ? 'playoff-matchup' : ''}">
                            ${seed1}<span class="schedule-team">${team1}</span>
                            <span class="schedule-vs">vs</span>
                            <span class="schedule-team">${team2}</span>${seed2}
                        </div>
                    `;
                };
                
                // Render regular season week
                if (!isPlayoffs) {
                    return `
                        <div class="${cardClasses}">
                            <div class="schedule-week-header">
                                <span class="schedule-week-title ${titleClass}">${weekTitle}</span>
                                ${badge}
                            </div>
                            ${week.matchups.map(renderMatchup).join('')}
                        </div>
                    `;
                }
                
                // Render playoff week with brackets
                const bracketOrder = ['playoffs', 'championship', 'consolation_cup', 'mid_bowl', 'sewer_series', 'toilet_bowl', 'other'];
                const bracketHtml = bracketOrder
                    .filter(bracket => matchupsByBracket[bracket])
                    .map(bracket => {
                        const label = bracketLabels[bracket] || '';
                        return `
                            ${label ? `<div class="bracket-label ${bracket}">${label}</div>` : ''}
                            ${matchupsByBracket[bracket].map(renderMatchup).join('')}
                        `;
                    }).join('');
                
                return `
                    <div class="${cardClasses}">
                        <div class="schedule-week-header">
                            <span class="schedule-week-title ${titleClass}">${weekTitle}</span>
                            ${badge}
                        </div>
                        ${bracketHtml}
                    </div>
                `;
            }).join('');
        }

        let currentTeam = null;

        function renderTeams() {
            // Get unique teams from standings
            const teams = data.standings;
            if (!teams || teams.length === 0) return;
            
            // Default to first team if none selected
            if (!currentTeam) currentTeam = teams[0].abbrev;
            
            // Render team selector buttons
            const selectorContainer = document.getElementById('team-selector');
            selectorContainer.innerHTML = teams.map(team => `
                <button class="team-btn ${team.abbrev === currentTeam ? 'active' : ''}" 
                        data-team="${team.abbrev}">${team.abbrev}</button>
            `).join('');
            
            // Add click handlers
            selectorContainer.querySelectorAll('.team-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    currentTeam = btn.dataset.team;
                    renderTeams();
                });
            });
            
            // Find team info
            const teamInfo = teams.find(t => t.abbrev === currentTeam);
            if (!teamInfo) return;
            
            // Get all weeks with scores
            const weeksWithScores = data.weeks.filter(w => w.has_scores);
            
            // Build player data across all weeks
            const playerMap = new Map(); // player key -> {name, team, position, weeks: {weekNum: {score, starter}}}
            
            weeksWithScores.forEach(week => {
                // Find this team in the week's matchups
                let teamData = null;
                for (const matchup of week.matchups) {
                    if (matchup.team1.abbrev === currentTeam) {
                        teamData = matchup.team1;
                        break;
                    }
                    if (matchup.team2.abbrev === currentTeam) {
                        teamData = matchup.team2;
                        break;
                    }
                }
                if (!teamData || !teamData.roster) return;
                
                teamData.roster.forEach(player => {
                    const key = `${player.position}-${player.name}`;
                    if (!playerMap.has(key)) {
                        playerMap.set(key, {
                            name: player.name,
                            nfl_team: player.nfl_team,
                            position: player.position,
                            weeks: {}
                        });
                    }
                    playerMap.get(key).weeks[week.week] = {
                        score: player.score,
                        starter: player.starter
                    };
                });
            });
            
            // Group by position
            const positions = ['QB', 'RB', 'WR', 'TE', 'K', 'D/ST', 'HC', 'OL'];
            const playersByPosition = {};
            positions.forEach(pos => playersByPosition[pos] = []);
            
            playerMap.forEach((player, key) => {
                if (playersByPosition[player.position]) {
                    playersByPosition[player.position].push(player);
                }
            });
            
            // Build table
            const weekHeaders = weeksWithScores.map(w => 
                `<th class="week-col">W${w.week}</th>`
            ).join('');
            
            let tableRows = '';
            const weekTotals = {};
            weeksWithScores.forEach(w => weekTotals[w.week] = 0);
            
            positions.forEach(pos => {
                const players = playersByPosition[pos];
                if (players.length === 0) return;
                
                // Position header row
                tableRows += `<tr class="position-group"><td colspan="${weeksWithScores.length + 4}">${pos}</td></tr>`;
                
                players.forEach(player => {
                    let playerSeasonTotal = 0;
                    const weekScores = weeksWithScores.map(w => {
                        const weekData = player.weeks[w.week];
                        if (!weekData) return '<td class="week-score">-</td>';
                        const cls = weekData.starter ? 'starter' : 'bench';
                        if (weekData.starter) weekTotals[w.week] += weekData.score;
                        playerSeasonTotal += weekData.score;
                        return `<td class="week-score ${cls}">${weekData.score.toFixed(0)}</td>`;
                    }).join('');
                    
                    tableRows += `
                        <tr>
                            <td class="player-name">${player.name}</td>
                            <td class="player-team">${player.nfl_team}</td>
                            ${weekScores}
                            <td class="week-score season-total">${playerSeasonTotal.toFixed(0)}</td>
                        </tr>
                    `;
                });
            });
            
            // Total row
            const totalScores = weeksWithScores.map(w => 
                `<td class="week-score">${weekTotals[w.week].toFixed(0)}</td>`
            ).join('');
            const starterSeasonTotal = Object.values(weekTotals).reduce((a, b) => a + b, 0);
            tableRows += `
                <tr class="total-row">
                    <td colspan="2"><strong>TOTAL</strong></td>
                    ${totalScores}
                    <td class="week-score">${starterSeasonTotal.toFixed(0)}</td>
                </tr>
            `;
            
            // Build taxi squad section
            let taxiHtml = '';
            // Get taxi squad from most recent week
            const mostRecentWeek = weeksWithScores[weeksWithScores.length - 1];
            if (mostRecentWeek) {
                let teamData = null;
                for (const matchup of mostRecentWeek.matchups) {
                    if (matchup.team1.abbrev === currentTeam) {
                        teamData = matchup.team1;
                        break;
                    }
                    if (matchup.team2.abbrev === currentTeam) {
                        teamData = matchup.team2;
                        break;
                    }
                }
                if (teamData && teamData.taxi_squad && teamData.taxi_squad.length > 0) {
                    taxiHtml = `
                        <div class="taxi-squad-section">
                            <h3>Taxi Squad</h3>
                            <p class="taxi-description">Exclusive development players - cannot be started without promotion to active roster</p>
                            <div class="taxi-players">
                                ${teamData.taxi_squad.map(p => `
                                    <div class="taxi-player">
                                        <span class="taxi-position">${p.position}</span>
                                        <span class="taxi-name">${p.name}</span>
                                        <span class="taxi-team">${p.nfl_team}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
            }
            
            // Build draft picks section
            let picksHtml = '';
            if (data.draft_picks && data.draft_picks[currentTeam]) {
                const teamPicks = data.draft_picks[currentTeam];
                const seasons = ['2026', '2027', '2028', '2029'];
                const draftTypes = [
                    { key: 'offseason', label: 'Offseason Draft' },
                    { key: 'offseason_taxi', label: 'Offseason Taxi' },
                    { key: 'waiver', label: 'Waiver Draft' },
                    { key: 'waiver_taxi', label: 'Waiver Taxi' }
                ];
                
                picksHtml = `
                    <div class="draft-picks-section">
                        <h3>Draft Picks</h3>
                        <div class="picks-grid">
                            ${seasons.map(season => `
                                <div class="picks-season">
                                    <div class="picks-season-header">${season}</div>
                                    ${draftTypes.map(dt => {
                                        const picks = teamPicks[season][dt.key];
                                        if (!picks || picks.length === 0) return '';
                                        return `
                                            <div class="picks-draft-type">
                                                <div class="picks-type-label">${dt.label}</div>
                                                <div class="picks-list">
                                                    ${picks.map(p => {
                                                        const fromLabel = p.own ? '' : ` <span class="pick-from">(${p.from})</span>`;
                                                        return `<span class="pick-item ${p.own ? 'own' : 'acquired'}">R${p.round}${fromLabel}</span>`;
                                                    }).join('')}
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            // Render
            const rosterContainer = document.getElementById('team-roster-container');
            rosterContainer.innerHTML = `
                <div class="team-header">
                    <h2>${teamInfo.name}</h2>
                    <div class="owner">${teamInfo.owner}</div>
                </div>
                <div style="overflow-x: auto;">
                    <table class="roster-table">
                        <thead>
                            <tr>
                                <th>Player</th>
                                <th>Team</th>
                                ${weekHeaders}
                                <th class="week-col season-col">Season</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${tableRows}
                        </tbody>
                    </table>
                </div>
                ${taxiHtml}
                ${picksHtml}
            `;
        }

        function renderBanners() {
            if (!data.banners) return;
            
            const container = document.getElementById('banners-container');
            container.innerHTML = data.banners.map(img => `
                <div class="banner-item">
                    <img src="images/banners/${img}" alt="Championship Banner" loading="lazy">
                </div>
            `).join('');
        }

        function renderHallOfFame() {
            if (!data.hall_of_fame) return;
            
            const hof = data.hall_of_fame;
            const container = document.getElementById('hof-container');
            
            let html = '';
            
            // Owner Stats Table
            if (hof.owner_stats && hof.owner_stats.length > 0) {
                html += `
                    <div class="hof-section">
                        <div class="hof-section-title">Owner Statistics</div>
                        <table class="owner-stats-table">
                            <thead>
                                <tr>
                                    <th>Owner</th>
                                    <th>Seasons</th>
                                    <th>Record</th>
                                    <th>Playoffs</th>
                                    <th>Rings</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${hof.owner_stats.map(owner => `
                                    <tr>
                                        <td>${owner.Owner || ''}</td>
                                        <td>${owner.Seasons || ''}</td>
                                        <td>${owner.Record || ''}</td>
                                        <td>${owner['Playoff Berths'] || ''}</td>
                                        <td class="rings">${'ðŸ†'.repeat(parseInt(owner.Rings) || 0)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }
            
            // Finishes by Year (filter out MVPs section)
            const yearResults = hof.finishes_by_year?.filter(y => !y.year.includes('MVP')) || [];
            const mvpSection = hof.finishes_by_year?.find(y => y.year.includes('MVP'));
            
            if (yearResults.length > 0) {
                html += `
                    <div class="hof-section">
                        <div class="hof-section-title">Champions by Year</div>
                        ${yearResults.map(year => `
                            <div class="hof-year">
                                <div class="hof-year-title">${year.year}</div>
                                <ul class="hof-year-results">
                                    ${year.results.map(r => `<li>${r}</li>`).join('')}
                                </ul>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            // MVPs (from mvps array or finishes_by_year)
            const mvps = hof.mvps?.length > 0 ? hof.mvps : (mvpSection?.results || []);
            if (mvps.length > 0) {
                html += `
                    <div class="hof-section">
                        <div class="hof-section-title">League MVPs</div>
                        ${mvps.map(mvp => `<div class="record-item">${mvp}</div>`).join('')}
                    </div>
                `;
            }
            
            // Team Records
            if (hof.team_records && hof.team_records.length > 0) {
                html += `
                    <div class="hof-section">
                        <div class="hof-section-title">Team Records</div>
                        ${hof.team_records.map(section => `
                            <div class="record-subsection">
                                <div class="record-subsection-title">${section.title}</div>
                                ${section.records.map(r => `<div class="record-item">${r}</div>`).join('')}
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            // Player Records
            if (hof.player_records && hof.player_records.length > 0) {
                html += `
                    <div class="hof-section">
                        <div class="hof-section-title">Player Records</div>
                        ${hof.player_records.map(section => `
                            <div class="record-subsection">
                                <div class="record-subsection-title">${section.title}</div>
                                ${section.records.map(r => `<div class="record-item">${r}</div>`).join('')}
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }

        let currentTransactionSeason = 0;

        function renderTransactions() {
            if (!data.transactions || data.transactions.length === 0) return;
            
            // Render season selector
            const selectorContainer = document.getElementById('transactions-season-selector');
            selectorContainer.innerHTML = data.transactions.map((season, idx) => `
                <button class="season-btn ${idx === currentTransactionSeason ? 'active' : ''}" 
                        data-season="${idx}">${season.season.replace(' Season', '')}</button>
            `).join('');
            
            // Add click handlers
            selectorContainer.querySelectorAll('.season-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    currentTransactionSeason = parseInt(btn.dataset.season);
                    renderTransactions();
                });
            });
            
            // Render selected season
            const season = data.transactions[currentTransactionSeason];
            const container = document.getElementById('transactions-container');
            container.innerHTML = `
                <div class="transactions-season">
                    ${season.weeks.map(week => `
                        <div class="transactions-week">
                            <div class="transactions-week-header">${week.title}</div>
                            ${week.transactions.map(trans => `
                                <div class="transaction-item">
                                    <div class="transaction-title">${trans.title}</div>
                                    ${trans.items && trans.items.length > 0 ? `
                                        <div class="transaction-details">
                                            ${trans.items.map(item => {
                                                if (item.type === 'header') {
                                                    return `<div class="transaction-subheader">${item.text}</div>`;
                                                }
                                                return `<div class="transaction-list-item">â€¢ ${item.text}</div>`;
                                            }).join('')}
                                        </div>
                                    ` : ''}
                                </div>
                            `).join('')}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Stats Leaders
        let currentStatsPosition = 'ALL';

        function getStatsLeaders() {
            // Aggregate player stats across all weeks
            const playerStats = {};  // key: "playerName|nflTeam" -> {name, nfl_team, position, fantasy_team, total_points}
            
            if (!data) return {};
            
            // First, add all players from current rosters (so everyone rostered is included)
            if (data.rosters) {
                for (const [teamAbbrev, roster] of Object.entries(data.rosters)) {
                    for (const player of roster) {
                        if (!player.name || !player.position) continue;
                        
                        // Include position in key to differentiate OL vs D/ST for same NFL team
                        const key = `${player.name}|${player.nfl_team || ''}|${player.position}`;
                        
                        if (!playerStats[key]) {
                            playerStats[key] = {
                                name: player.name,
                                nfl_team: player.nfl_team || '',
                                position: player.position,
                                fantasy_team: teamAbbrev,
                                total_points: 0,
                                weeks_played: 0
                            };
                        }
                    }
                }
            }
            
            // Then aggregate stats from matchups
            if (data.weeks) {
                for (const week of data.weeks) {
                    if (!week.matchups) continue;
                    
                    for (const matchup of week.matchups) {
                        for (const teamData of [matchup.team1, matchup.team2]) {
                            const fantasyTeam = teamData.abbrev;
                            const roster = teamData.roster || [];
                            
                            for (const player of roster) {
                                if (!player.name || !player.position) continue;
                                
                                // Include position in key to differentiate OL vs D/ST for same NFL team
                                const key = `${player.name}|${player.nfl_team || ''}|${player.position}`;
                                
                                if (!playerStats[key]) {
                                    playerStats[key] = {
                                        name: player.name,
                                        nfl_team: player.nfl_team || '',
                                        position: player.position,
                                        fantasy_team: fantasyTeam,
                                        total_points: 0,
                                        weeks_played: 0
                                    };
                                }
                                
                                // Always update fantasy team to track ownership
                                playerStats[key].fantasy_team = fantasyTeam;
                                
                                // Add points if player has a score (including negative)
                                if (player.score !== undefined && player.score !== null) {
                                    playerStats[key].total_points += player.score;
                                    if (player.score !== 0) {
                                        playerStats[key].weeks_played++;
                                    }
                                }
                            }
                        }
                    }
                }
            }
            
            // Group by position
            const byPosition = {};
            for (const player of Object.values(playerStats)) {
                if (!byPosition[player.position]) {
                    byPosition[player.position] = [];
                }
                byPosition[player.position].push(player);
            }
            
            // Sort each position by total points descending
            for (const pos of Object.keys(byPosition)) {
                byPosition[pos].sort((a, b) => b.total_points - a.total_points);
            }
            
            return byPosition;
        }

        function renderStatsLeaders() {
            const leaders = getStatsLeaders();
            const positions = ['QB', 'RB', 'WR', 'TE', 'K', 'D/ST', 'HC', 'OL'];
            const positionNames = {
                'QB': 'Quarterbacks',
                'RB': 'Running Backs',
                'WR': 'Wide Receivers',
                'TE': 'Tight Ends',
                'K': 'Kickers',
                'D/ST': 'Defenses',
                'HC': 'Head Coaches',
                'OL': 'Offensive Lines'
            };
            
            // Render position selector
            const selector = document.getElementById('stats-position-selector');
            selector.innerHTML = `
                <button class="stats-pos-btn ${currentStatsPosition === 'ALL' ? 'active' : ''}" data-pos="ALL">All</button>
                ${positions.map(pos => `
                    <button class="stats-pos-btn ${currentStatsPosition === pos ? 'active' : ''}" data-pos="${pos}">${pos}</button>
                `).join('')}
            `;
            
            selector.querySelectorAll('.stats-pos-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    currentStatsPosition = btn.dataset.pos;
                    renderStatsLeaders();
                });
            });
            
            // Render leaders grid
            const container = document.getElementById('stats-leaders-container');
            const positionsToShow = currentStatsPosition === 'ALL' ? positions : [currentStatsPosition];
            
            container.innerHTML = positionsToShow.map(pos => {
                const posLeaders = currentStatsPosition === 'ALL' 
                    ? (leaders[pos] || []).slice(0, 5)
                    : (leaders[pos] || []);
                if (posLeaders.length === 0) return '';
                
                return `
                    <div class="stats-position-card">
                        <div class="stats-position-header">${positionNames[pos] || pos}</div>
                        ${posLeaders.map((player, idx) => {
                            const rank = idx + 1;
                            const rankClass = rank <= 3 ? `rank-${rank}` : '';
                            return `
                                <div class="stats-leader-row ${rankClass}">
                                    <div class="stats-rank">${rank}</div>
                                    <div class="stats-player-info">
                                        <div class="stats-player-name">${player.name}</div>
                                        <div class="stats-player-meta">
                                            <span class="stats-nfl-team">${player.nfl_team}</span>
                                            <span class="stats-fantasy-team">â€¢ ${player.fantasy_team}</span>
                                        </div>
                                    </div>
                                    <div class="stats-points">${player.total_points.toFixed(1)}</div>
                                </div>
                            `;
                        }).join('')}
                        ${currentStatsPosition === 'ALL' && (leaders[pos] || []).length > 5 ? `
                            <button class="stats-view-all" data-pos="${pos}">View all ${positionNames[pos]}</button>
                        ` : ''}
                    </div>
                `;
            }).join('');
            
            // Add click handlers for "view all" buttons
            container.querySelectorAll('.stats-view-all').forEach(btn => {
                btn.addEventListener('click', () => {
                    currentStatsPosition = btn.dataset.pos;
                    renderStatsLeaders();
                });
            });
        }

        function renderConstitution() {
            if (!data.constitution) return;
            
            const container = document.getElementById('constitution-container');
            
            // Number items within each section
            container.innerHTML = data.constitution.map(article => `
                <div class="constitution-article">
                    <div class="article-title">${article.title}</div>
                    ${article.sections.map(section => {
                        let itemNum = 0;
                        let subItemLetter = 'a';
                        return `
                            <div class="article-section">
                                <div class="section-title">${section.title}</div>
                                <div class="section-content">
                                    ${section.content.map(item => {
                                        if (item.type === 'subheader') {
                                            return `<div class="section-subheader">${item.text}</div>`;
                                        } else if (item.type === 'header') {
                                            itemNum = 0;
                                            subItemLetter = 'a';
                                            return `<div class="content-header">${item.text}</div>`;
                                        } else if (item.type === 'item') {
                                            itemNum++;
                                            subItemLetter = 'a';
                                            return `<div class="content-item"><span class="item-num">${itemNum}.</span> ${item.text}</div>`;
                                        } else if (item.type === 'subitem') {
                                            const letter = subItemLetter;
                                            subItemLetter = String.fromCharCode(subItemLetter.charCodeAt(0) + 1);
                                            return `<div class="content-subitem"><span class="item-num">${letter}.</span> ${item.text}</div>`;
                                        }
                                        return `<p>${item.text}</p>`;
                                    }).join('')}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `).join('');
        }

        // Lineup Form State
        const LINEUP_CONFIG = {
            // Use current host for API calls (works on both preview and production)
            workerUrl: window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
                ? 'https://scoring-henna.vercel.app/api/lineup'  // Fallback for local dev
                : `${window.location.origin}/api/lineup`,
            positions: {
                'QB': { max: 1, label: 'Quarterback' },
                'RB': { max: 2, label: 'Running Back' },
                'WR': { max: 2, label: 'Wide Receiver' },
                'TE': { max: 1, label: 'Tight End' },
                'K': { max: 1, label: 'Kicker' },
                'D/ST': { max: 1, label: 'Defense/ST' },
                'HC': { max: 1, label: 'Head Coach' },
                'OL': { max: 1, label: 'Offensive Line' }
            }
        };
        
        let lineupState = {
            team: null,
            week: null,
            roster: [],
            selections: {} // position -> [player names]
        };

        function initLineupForm() {
            const weekSelect = document.getElementById('lineup-week-select');
            
            // Collect all weeks - regular season from data.weeks plus playoff weeks from schedule
            const allWeeks = new Set();
            if (data && data.weeks) {
                data.weeks.forEach(w => allWeeks.add(w.week));
            }
            // Add playoff weeks from schedule
            if (data && data.schedule) {
                data.schedule.forEach(w => {
                    if (w.is_playoffs) allWeeks.add(w.week);
                });
            }
            
            const weekNumbers = Array.from(allWeeks).sort((a, b) => a - b);
            const playoffWeeks = new Set((data?.schedule || []).filter(w => w.is_playoffs).map(w => w.week));
            
            weekSelect.innerHTML = '<option value="">-- Select Week --</option>' +
                weekNumbers.map(w => {
                    const isPlayoff = playoffWeeks.has(w);
                    const scheduleWeek = data.schedule?.find(sw => sw.week === w);
                    const label = isPlayoff && scheduleWeek?.playoff_round 
                        ? `Week ${w} - ${scheduleWeek.playoff_round}`
                        : `Week ${w}`;
                    return `<option value="${w}"${w === data.current_week ? ' selected' : ''}>${label}</option>`;
                }).join('');
            
            // Event listener for week change
            weekSelect.onchange = loadRosterForEditing;
            document.getElementById('lineup-submit-btn').onclick = submitLineup;
            
            // If current week is preselected, load the roster
            if (weekSelect.value) {
                loadRosterForEditing();
            }
        }

        async function loadRosterForEditing() {
            const week = parseInt(document.getElementById('lineup-week-select').value);
            const teamAbbrev = manageState.team;
            const password = manageState.password;
            
            if (!week) {
                document.getElementById('lineup-editor').style.display = 'none';
                return;
            }
            
            // Find the team's roster for this week - check regular weeks first
            const weekData = data.weeks.find(w => w.week === week);
            const scheduleWeek = data.schedule?.find(w => w.week === week);
            const isPlayoffWeek = scheduleWeek?.is_playoffs;
            
            let teamData = null;
            let roster = [];
            
            if (weekData && weekData.matchups) {
                // Regular week - get roster from matchup data
                for (const matchup of weekData.matchups) {
                    if (matchup.team1.abbrev === teamAbbrev) {
                        teamData = matchup.team1;
                        break;
                    }
                    if (matchup.team2.abbrev === teamAbbrev) {
                        teamData = matchup.team2;
                        break;
                    }
                }
                if (teamData) {
                    roster = teamData.roster;
                }
            }
            
            // For playoff weeks (or any week without roster data), use the roster from the most recent regular season week
            if (roster.length === 0) {
                // Find the most recent week with this team's roster data
                const sortedWeeks = [...data.weeks].sort((a, b) => b.week - a.week);
                for (const w of sortedWeeks) {
                    if (w.matchups) {
                        for (const matchup of w.matchups) {
                            if (matchup.team1.abbrev === teamAbbrev && matchup.team1.roster?.length > 0) {
                                roster = matchup.team1.roster.map(p => ({
                                    name: p.name,
                                    nfl_team: p.nfl_team,
                                    position: p.position,
                                    score: 0,
                                    starter: false  // Reset starters for new week
                                }));
                                break;
                            }
                            if (matchup.team2.abbrev === teamAbbrev && matchup.team2.roster?.length > 0) {
                                roster = matchup.team2.roster.map(p => ({
                                    name: p.name,
                                    nfl_team: p.nfl_team,
                                    position: p.position,
                                    score: 0,
                                    starter: false
                                }));
                                break;
                            }
                        }
                    }
                    if (roster.length > 0) break;
                }
            }
            
            if (roster.length === 0) {
                document.getElementById('submit-status').className = 'submit-status error';
                document.getElementById('submit-status').textContent = 'No roster data available for this week';
                document.getElementById('lineup-editor').style.display = 'none';
                return;
            }
            
            // Store state
            const canonicalTeam = data.teams?.find(t => t.abbrev === teamAbbrev);
            lineupState.team = teamAbbrev;
            lineupState.teamName = canonicalTeam?.name || teamAbbrev;
            lineupState.week = week;
            lineupState.password = password;
            lineupState.roster = roster;
            lineupState.selections = {};
            
            // Initialize selections based on current starters
            Object.keys(LINEUP_CONFIG.positions).forEach(pos => {
                lineupState.selections[pos] = roster
                    .filter(p => p.position === pos && p.starter)
                    .map(p => p.name);
            });
            
            // Show editor
            document.getElementById('lineup-editor').style.display = 'block';
            const weekLabel = isPlayoffWeek && scheduleWeek?.playoff_round
                ? `${scheduleWeek.playoff_round}`
                : `Week ${week}`;
            document.getElementById('editor-week-label').textContent = weekLabel;
            document.getElementById('submit-status').textContent = '';
            document.getElementById('submit-status').className = 'submit-status';
            
            renderLineupEditor();
        }

        function resetLineupForm() {
            document.getElementById('lineup-editor').style.display = 'none';
            document.getElementById('submit-status').textContent = '';
            document.getElementById('submit-status').className = 'submit-status';
            document.getElementById('lineup-week-select').value = '';
            lineupState = { team: null, week: null, roster: [], selections: {} };
        }

        function renderLineupEditor() {
            const container = document.getElementById('position-groups');
            const positions = Object.keys(LINEUP_CONFIG.positions);
            const lockedPlayers = getLockedPlayers();
            
            container.innerHTML = positions.map(pos => {
                const config = LINEUP_CONFIG.positions[pos];
                const players = lineupState.roster.filter(p => p.position === pos);
                const selected = lineupState.selections[pos] || [];
                const isFull = selected.length === config.max;
                const countClass = isFull ? 'complete' : '';
                
                return `
                    <div class="position-group-card">
                        <div class="position-group-header">
                            <span class="position-label">${pos} - ${config.label}</span>
                            <span class="starter-count ${countClass}">${selected.length}/${config.max} starting</span>
                        </div>
                        <div class="player-options">
                            ${players.map(p => {
                                const isSelected = selected.includes(p.name);
                                const isLocked = lockedPlayers.has(p.name);
                                const classes = [
                                    'player-option',
                                    isSelected ? 'selected' : '',
                                    isLocked ? 'locked' : ''
                                ].filter(Boolean).join(' ');
                                
                                return `
                                    <div class="${classes}" 
                                         data-position="${pos}" data-player="${p.name}" data-locked="${isLocked}">
                                        <div class="starter-indicator">${isLocked ? 'ðŸ”’' : ''}</div>
                                        <div class="player-details">
                                            <span class="player-name">${p.name}</span>
                                            <span class="player-team">${p.nfl_team}</span>
                                            ${isLocked ? '<span class="locked-label">LOCKED</span>' : ''}
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            }).join('');
            
            // Add click handlers (only for unlocked players)
            container.querySelectorAll('.player-option').forEach(el => {
                el.addEventListener('click', () => {
                    if (el.dataset.locked === 'true') {
                        // Show message that player is locked
                        const statusEl = document.getElementById('submit-status');
                        statusEl.className = 'submit-status error';
                        statusEl.textContent = `${el.dataset.player}'s game has already started - lineup locked`;
                        setTimeout(() => { statusEl.textContent = ''; statusEl.className = 'submit-status'; }, 3000);
                        return;
                    }
                    const pos = el.dataset.position;
                    const player = el.dataset.player;
                    togglePlayerSelection(pos, player);
                });
            });
            
            updateLineupSummary();
        }

        function togglePlayerSelection(position, playerName) {
            const config = LINEUP_CONFIG.positions[position];
            const selected = lineupState.selections[position] || [];
            
            if (selected.includes(playerName)) {
                // Deselect - always allowed
                lineupState.selections[position] = selected.filter(p => p !== playerName);
            } else {
                // Select (if under max limit)
                if (selected.length < config.max) {
                    lineupState.selections[position] = [...selected, playerName];
                }
                // At max - do nothing (user must deselect first)
            }
            
            renderLineupEditor();
        }

        function updateLineupSummary() {
            const summary = document.getElementById('lineup-summary');
            const submitBtn = document.getElementById('lineup-submit-btn');
            
            let total = 0;
            let maxTotal = 0;
            Object.keys(LINEUP_CONFIG.positions).forEach(pos => {
                const config = LINEUP_CONFIG.positions[pos];
                const selected = (lineupState.selections[pos] || []).length;
                total += selected;
                maxTotal += config.max;
            });
            
            // Always valid - users can start 0 to max players
            summary.textContent = `${total} starters selected (max ${maxTotal})`;
            summary.className = 'lineup-summary valid';
            submitBtn.disabled = false;
        }

        function isPlayerLocked(player) {
            // Check if player's game has started based on game_times data
            // JSON keys are strings, so convert week to string
            const weekKey = String(lineupState.week);
            if (!data.game_times || !data.game_times[weekKey]) {
                console.log('No game times for week', weekKey);
                return false;
            }
            
            const gameTimes = data.game_times[weekKey];
            const playerTeam = player.nfl_team;
            const gameTime = gameTimes[playerTeam];
            
            if (!gameTime) {
                console.log('No game time for team', playerTeam);
                return false;
            }
            
            const kickoff = new Date(gameTime);
            const now = new Date();
            const isLocked = now >= kickoff;
            
            // Debug logging
            if (player.name.includes('Campbell') || player.name.includes('Lamb')) {
                console.log(`${player.name} (${playerTeam}): kickoff=${gameTime}, now=${now.toISOString()}, locked=${isLocked}`);
            }
            
            return isLocked;
        }

        function getLockedPlayers() {
            // Returns set of player names that are locked
            const locked = new Set();
            lineupState.roster.forEach(player => {
                if (isPlayerLocked(player)) {
                    locked.add(player.name);
                }
            });
            return locked;
        }

        async function submitLineup() {
            const statusEl = document.getElementById('submit-status');
            const submitBtn = document.getElementById('lineup-submit-btn');
            
            // Check for localhost
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                statusEl.className = 'submit-status error';
                statusEl.textContent = 'Lineup submission only works on the deployed site (Vercel). Local testing shows the UI only.';
                return;
            }
            
            statusEl.className = 'submit-status loading';
            statusEl.textContent = 'Submitting lineup...';
            submitBtn.disabled = true;
            
            // Get currently locked players (games already started)
            const lockedPlayers = getLockedPlayers();
            
            const payload = {
                team: lineupState.team,
                week: lineupState.week,
                password: lineupState.password,
                starters: lineupState.selections,
                locked_players: Array.from(lockedPlayers)
            };
            
            try {
                const response = await fetch(LINEUP_CONFIG.workerUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const result = await response.json();
                
                if (response.ok && result.success) {
                    statusEl.className = 'submit-status success';
                    statusEl.textContent = 'âœ“ Lineup submitted successfully! Changes will be reflected after the next update.';
                } else {
                    statusEl.className = 'submit-status error';
                    statusEl.textContent = result.error || 'Failed to submit lineup';
                    submitBtn.disabled = false;
                }
            } catch (error) {
                statusEl.className = 'submit-status error';
                statusEl.textContent = 'Network error - please try again. Make sure you are on the deployed site.';
                submitBtn.disabled = false;
            }
        }

        // Navigation
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                document.querySelectorAll('.view-container').forEach(v => v.classList.remove('active'));
                document.getElementById(`${btn.dataset.view}-view`).classList.add('active');
                
                // Initialize manage roster when navigating to it
                if (btn.dataset.view === 'manage') {
                    initManageRoster();
                }
            });
        });

        // Hall of Fame sub-navigation
        document.querySelectorAll('.hof-subnav-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                // Update active button
                document.querySelectorAll('.hof-subnav-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                // Show correct subview
                document.querySelectorAll('.hof-subview').forEach(v => v.classList.remove('active'));
                document.getElementById(`hof-${btn.dataset.subview}-subview`).classList.add('active');
            });
        });

        // ====== MANAGE ROSTER SECTION ======
        const MANAGE_CONFIG = {
            // Use current host for API calls (works on both preview and production)
            apiUrl: window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
                ? 'https://scoring-henna.vercel.app/api/transaction'  // Fallback for local dev
                : `${window.location.origin}/api/transaction`
        };

        let manageState = {
            team: null,
            password: null,
            selectedTaxiPlayer: null,
            selectedReleasePlayer: null,
            selectedFaPlayer: null,
            selectedFaReleasePlayer: null,
            tradeGivePlayers: [],
            tradeGivePicks: [],
            tradeReceivePlayers: [],
            tradeReceivePicks: [],
            tradePartner: null
        };

        function initManageRoster() {
            const teamSelect = document.getElementById('manage-team-select');
            teamSelect.innerHTML = '<option value="">-- Choose Team --</option>';
            
            if (data && data.weeks && data.weeks.length > 0) {
                const teams = data.weeks[data.weeks.length - 1].teams;
                teams.forEach(team => {
                    const option = document.createElement('option');
                    option.value = team.abbrev;
                    option.textContent = `${team.name} (${team.abbrev})`;
                    teamSelect.appendChild(option);
                });
            }
            
            // Reset state
            resetManageState();
            resetLineupForm();
            document.getElementById('manage-auth').style.display = 'block';
            document.getElementById('manage-panel').style.display = 'none';
            document.getElementById('manage-error').textContent = '';
            
            // Set up event listeners
            document.getElementById('manage-login-btn').onclick = handleManageLogin;
            document.getElementById('manage-logout-btn').onclick = handleManageLogout;
            
            // Set up tab switching
            document.querySelectorAll('.tx-tab').forEach(tab => {
                tab.onclick = () => switchTxTab(tab.dataset.tab);
            });
            
            // Reset to first tab (lineup)
            switchTxTab('lineup');
        }

        function resetManageState() {
            manageState = {
                team: null,
                password: null,
                selectedTaxiPlayer: null,
                selectedReleasePlayer: null,
                selectedFaPlayer: null,
                selectedFaReleasePlayer: null,
                tradeGivePlayers: [],
                tradeGivePicks: [],
                tradeReceivePlayers: [],
                tradeReceivePicks: [],
                tradePartner: null
            };
        }

        async function handleManageLogin() {
            const team = document.getElementById('manage-team-select').value;
            const password = document.getElementById('manage-password').value;
            const errorEl = document.getElementById('manage-error');
            
            if (!team || !password) {
                errorEl.textContent = 'Please select a team and enter password';
                return;
            }
            
            errorEl.textContent = 'Validating...';
            
            try {
                const response = await fetch(MANAGE_CONFIG.apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'validate', team, password })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    manageState.team = team;
                    manageState.password = password;
                    
                    document.getElementById('manage-auth').style.display = 'none';
                    document.getElementById('manage-panel').style.display = 'block';
                    
                    // Use canonical team name from data.teams
                    const canonicalTeam = data.teams?.find(t => t.abbrev === team);
                    document.getElementById('manage-team-name').textContent = canonicalTeam?.name || team;
                    
                    // Initialize lineup form and other tabs
                    initLineupForm();
                    renderTaxiTab();
                    renderFaTab();
                    renderTradeTab();
                    renderPendingTrades();
                } else {
                    errorEl.textContent = result.error || 'Invalid password';
                }
            } catch (e) {
                console.error('Login error:', e);
                // Allow localhost testing without API validation
                if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                    manageState.team = team;
                    manageState.password = password;
                    
                    document.getElementById('manage-auth').style.display = 'none';
                    document.getElementById('manage-panel').style.display = 'block';
                    
                    const canonicalTeam = data.teams?.find(t => t.abbrev === team);
                    document.getElementById('manage-team-name').textContent = canonicalTeam?.name || team;
                    
                    initLineupForm();
                    renderTaxiTab();
                    renderFaTab();
                    renderTradeTab();
                    renderPendingTrades();
                    errorEl.textContent = '';
                } else {
                    errorEl.textContent = 'Network error - please try again';
                }
            }
        }

        function handleManageLogout() {
            resetManageState();
            resetLineupForm();
            document.getElementById('manage-auth').style.display = 'block';
            document.getElementById('manage-panel').style.display = 'none';
            document.getElementById('manage-password').value = '';
            // Reset to first tab (lineup)
            switchTxTab('lineup');
        }

        function switchTxTab(tabName) {
            document.querySelectorAll('.tx-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`.tx-tab[data-tab="${tabName}"]`).classList.add('active');
            
            document.querySelectorAll('.tx-content').forEach(c => c.classList.remove('active'));
            document.getElementById(`tx-${tabName}`).classList.add('active');
        }

        function getTeamData(abbrev) {
            if (!data || !data.weeks) return null;
            const latestWeek = data.weeks[data.weeks.length - 1];
            return latestWeek.teams.find(t => t.abbrev === abbrev);
        }

        function renderTaxiTab() {
            const teamData = getTeamData(manageState.team);
            if (!teamData) return;
            
            const taxiList = document.getElementById('taxi-players');
            const taxiSquad = teamData.taxi_squad || [];
            
            if (taxiSquad.length === 0) {
                taxiList.innerHTML = '<p class="no-pending-trades">No players on taxi squad</p>';
                return;
            }
            
            taxiList.innerHTML = taxiSquad.map(player => `
                <div class="tx-player" data-name="${player.name}" data-position="${player.position}">
                    <span class="position-tag">${player.position}</span>
                    <span class="player-name">${player.name}</span>
                    <span class="player-team">${player.nfl_team}</span>
                </div>
            `).join('');
            
            // Add click handlers
            taxiList.querySelectorAll('.tx-player').forEach(el => {
                el.onclick = () => selectTaxiPlayer(el.dataset.name, el.dataset.position);
            });
            
            document.getElementById('taxi-release-section').style.display = 'none';
            document.getElementById('taxi-actions').style.display = 'none';
            
            // Set up submit handler
            document.getElementById('taxi-submit-btn').onclick = submitTaxiActivation;
        }

        function selectTaxiPlayer(name, position) {
            // Clear previous selection
            document.querySelectorAll('#taxi-players .tx-player').forEach(el => el.classList.remove('selected'));
            
            // Select new player
            const selected = document.querySelector(`#taxi-players .tx-player[data-name="${name}"]`);
            if (selected) selected.classList.add('selected');
            
            manageState.selectedTaxiPlayer = { name, position };
            manageState.selectedReleasePlayer = null;
            
            // Show release options
            renderTaxiReleaseOptions(position);
        }

        function renderTaxiReleaseOptions(position) {
            const teamData = getTeamData(manageState.team);
            const roster = teamData.roster.filter(p => p.position === position);
            
            const releaseSection = document.getElementById('taxi-release-section');
            const releaseList = document.getElementById('taxi-release-players');
            
            if (roster.length === 0) {
                releaseList.innerHTML = `<p>No ${position} players on active roster to release</p>`;
            } else {
                releaseList.innerHTML = roster.map(player => `
                    <div class="tx-player" data-name="${player.name}">
                        <span class="position-tag">${player.position}</span>
                        <span class="player-name">${player.name}</span>
                        <span class="player-team">${player.nfl_team}</span>
                    </div>
                `).join('');
                
                releaseList.querySelectorAll('.tx-player').forEach(el => {
                    el.onclick = () => selectTaxiReleasePlayer(el.dataset.name);
                });
            }
            
            releaseSection.style.display = 'block';
        }

        function selectTaxiReleasePlayer(name) {
            document.querySelectorAll('#taxi-release-players .tx-player').forEach(el => el.classList.remove('selected'));
            document.querySelector(`#taxi-release-players .tx-player[data-name="${name}"]`).classList.add('selected');
            
            manageState.selectedReleasePlayer = name;
            
            // Show actions
            document.getElementById('taxi-actions').style.display = 'flex';
            document.getElementById('taxi-summary').textContent = 
                `Activate ${manageState.selectedTaxiPlayer.name} â†’ Release ${name}`;
        }

        async function submitTaxiActivation() {
            const statusEl = document.getElementById('taxi-status');
            statusEl.className = 'submit-status loading';
            statusEl.textContent = 'Processing...';
            
            try {
                const response = await fetch(MANAGE_CONFIG.apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'taxi_activate',
                        team: manageState.team,
                        password: manageState.password,
                        player_to_activate: manageState.selectedTaxiPlayer.name,
                        player_to_release: manageState.selectedReleasePlayer,
                        week: data.current_week
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    statusEl.className = 'submit-status success';
                    statusEl.textContent = result.message;
                    // Reload data
                    setTimeout(() => loadData(), 2000);
                } else {
                    statusEl.className = 'submit-status error';
                    statusEl.textContent = result.error;
                }
            } catch (e) {
                statusEl.className = 'submit-status error';
                statusEl.textContent = 'Network error - please try again';
            }
        }

        function renderFaTab() {
            const faList = document.getElementById('fa-players');
            const faPool = data.fa_pool || [];
            
            if (faPool.length === 0) {
                faList.innerHTML = '<p class="no-pending-trades">No players in FA pool</p>';
                return;
            }
            
            faList.innerHTML = faPool.map(player => `
                <div class="tx-player ${player.available === false ? 'unavailable' : ''}" 
                     data-name="${player.name}" data-position="${player.position}"
                     ${player.available === false ? 'title="Already activated"' : ''}>
                    <span class="position-tag">${player.position}</span>
                    <span class="player-name">${player.name}</span>
                    <span class="player-team">${player.nfl_team}</span>
                    ${player.available === false ? '<span class="locked-label">TAKEN</span>' : ''}
                </div>
            `).join('');
            
            // Add click handlers only for available players
            faList.querySelectorAll('.tx-player:not(.unavailable)').forEach(el => {
                el.onclick = () => selectFaPlayer(el.dataset.name, el.dataset.position);
            });
            
            document.getElementById('fa-release-section').style.display = 'none';
            document.getElementById('fa-actions').style.display = 'none';
            
            document.getElementById('fa-submit-btn').onclick = submitFaActivation;
        }

        function selectFaPlayer(name, position) {
            document.querySelectorAll('#fa-players .tx-player').forEach(el => el.classList.remove('selected'));
            document.querySelector(`#fa-players .tx-player[data-name="${name}"]`).classList.add('selected');
            
            manageState.selectedFaPlayer = { name, position };
            manageState.selectedFaReleasePlayer = null;
            
            renderFaReleaseOptions(position);
        }

        function renderFaReleaseOptions(position) {
            const teamData = getTeamData(manageState.team);
            const roster = teamData.roster.filter(p => p.position === position);
            
            const releaseSection = document.getElementById('fa-release-section');
            const releaseList = document.getElementById('fa-release-players');
            
            if (roster.length === 0) {
                releaseList.innerHTML = `<p>No ${position} players on active roster to release</p>`;
            } else {
                releaseList.innerHTML = roster.map(player => `
                    <div class="tx-player" data-name="${player.name}">
                        <span class="position-tag">${player.position}</span>
                        <span class="player-name">${player.name}</span>
                        <span class="player-team">${player.nfl_team}</span>
                    </div>
                `).join('');
                
                releaseList.querySelectorAll('.tx-player').forEach(el => {
                    el.onclick = () => selectFaReleasePlayer(el.dataset.name);
                });
            }
            
            releaseSection.style.display = 'block';
        }

        function selectFaReleasePlayer(name) {
            document.querySelectorAll('#fa-release-players .tx-player').forEach(el => el.classList.remove('selected'));
            document.querySelector(`#fa-release-players .tx-player[data-name="${name}"]`).classList.add('selected');
            
            manageState.selectedFaReleasePlayer = name;
            
            document.getElementById('fa-actions').style.display = 'flex';
            document.getElementById('fa-summary').textContent = 
                `Add ${manageState.selectedFaPlayer.name} â†’ Release ${name}`;
        }

        async function submitFaActivation() {
            const statusEl = document.getElementById('fa-status');
            statusEl.className = 'submit-status loading';
            statusEl.textContent = 'Processing...';
            
            try {
                const response = await fetch(MANAGE_CONFIG.apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'fa_activate',
                        team: manageState.team,
                        password: manageState.password,
                        player_to_add: manageState.selectedFaPlayer.name,
                        player_to_release: manageState.selectedFaReleasePlayer,
                        week: data.current_week
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    statusEl.className = 'submit-status success';
                    statusEl.textContent = result.message;
                    setTimeout(() => loadData(), 2000);
                } else {
                    statusEl.className = 'submit-status error';
                    statusEl.textContent = result.error;
                }
            } catch (e) {
                statusEl.className = 'submit-status error';
                statusEl.textContent = 'Network error - please try again';
            }
        }

        function renderTradeTab() {
            // Check trade deadline
            const deadlineWarning = document.getElementById('trade-deadline-warning');
            const tradeDeadline = data.trade_deadline_week || 12;
            
            if (data.current_week >= tradeDeadline) {
                deadlineWarning.textContent = `âš ï¸ Trade deadline has passed (Week ${tradeDeadline})`;
                document.getElementById('trade-submit-btn').disabled = true;
            } else {
                deadlineWarning.textContent = `Trade deadline: Start of Week ${tradeDeadline}`;
                document.getElementById('trade-submit-btn').disabled = false;
            }
            
            // Populate trade partner select
            const partnerSelect = document.getElementById('trade-partner-select');
            partnerSelect.innerHTML = '<option value="">-- Select Team --</option>';
            
            const teams = data.weeks[data.weeks.length - 1].teams;
            teams.filter(t => t.abbrev !== manageState.team).forEach(team => {
                const option = document.createElement('option');
                option.value = team.abbrev;
                option.textContent = `${team.name} (${team.abbrev})`;
                partnerSelect.appendChild(option);
            });
            
            partnerSelect.onchange = () => {
                manageState.tradePartner = partnerSelect.value;
                if (partnerSelect.value) {
                    renderTradePlayers();
                }
            };
            
            // Clear trade lists initially
            document.getElementById('trade-give-players').innerHTML = '<p class="no-pending-trades">Select trade partner first</p>';
            document.getElementById('trade-receive-players').innerHTML = '<p class="no-pending-trades">Select trade partner first</p>';
            document.getElementById('trade-give-picks').innerHTML = '';
            document.getElementById('trade-receive-picks').innerHTML = '';
            
            document.getElementById('trade-submit-btn').onclick = submitTradeProposal;
        }

        function renderTradePlayers() {
            const myTeamData = getTeamData(manageState.team);
            const partnerTeamData = getTeamData(manageState.tradePartner);
            
            if (!myTeamData || !partnerTeamData) return;
            
            // My players to give
            const giveList = document.getElementById('trade-give-players');
            giveList.innerHTML = myTeamData.roster.map(player => `
                <div class="tx-player" data-name="${player.name}">
                    <span class="position-tag">${player.position}</span>
                    <span class="player-name">${player.name}</span>
                    <span class="player-team">${player.nfl_team}</span>
                </div>
            `).join('');
            
            giveList.querySelectorAll('.tx-player').forEach(el => {
                el.onclick = () => toggleTradePlayer('give', el.dataset.name, el);
            });
            
            // Partner players to receive
            const receiveList = document.getElementById('trade-receive-players');
            receiveList.innerHTML = partnerTeamData.roster.map(player => `
                <div class="tx-player" data-name="${player.name}">
                    <span class="position-tag">${player.position}</span>
                    <span class="player-name">${player.name}</span>
                    <span class="player-team">${player.nfl_team}</span>
                </div>
            `).join('');
            
            receiveList.querySelectorAll('.tx-player').forEach(el => {
                el.onclick = () => toggleTradePlayer('receive', el.dataset.name, el);
            });
            
            // Draft picks (simplified - showing years 2026-2028)
            renderTradePicks();
        }

        function toggleTradePlayer(direction, name, el) {
            const list = direction === 'give' ? manageState.tradeGivePlayers : manageState.tradeReceivePlayers;
            const idx = list.indexOf(name);
            
            if (idx >= 0) {
                list.splice(idx, 1);
                el.classList.remove('selected');
            } else {
                list.push(name);
                el.classList.add('selected');
            }
        }

        function renderTradePicks() {
            const years = [2026, 2027, 2028];
            const rounds = [1, 2, 3, 4, 5];
            
            // My picks to give (simplified - would need to check ownership from data)
            const givePicksList = document.getElementById('trade-give-picks');
            givePicksList.innerHTML = years.map(year => 
                rounds.map(round => `
                    <div class="tx-pick" data-pick="${year}-${round}">
                        ${year} Round ${round}
                    </div>
                `).join('')
            ).join('');
            
            givePicksList.querySelectorAll('.tx-pick').forEach(el => {
                el.onclick = () => toggleTradePick('give', el.dataset.pick, el);
            });
            
            // Partner picks to receive
            const receivePicksList = document.getElementById('trade-receive-picks');
            receivePicksList.innerHTML = years.map(year => 
                rounds.map(round => `
                    <div class="tx-pick" data-pick="${year}-${round}">
                        ${year} Round ${round}
                    </div>
                `).join('')
            ).join('');
            
            receivePicksList.querySelectorAll('.tx-pick').forEach(el => {
                el.onclick = () => toggleTradePick('receive', el.dataset.pick, el);
            });
        }

        function toggleTradePick(direction, pick, el) {
            const list = direction === 'give' ? manageState.tradeGivePicks : manageState.tradeReceivePicks;
            const idx = list.indexOf(pick);
            
            if (idx >= 0) {
                list.splice(idx, 1);
                el.classList.remove('selected');
            } else {
                list.push(pick);
                el.classList.add('selected');
            }
        }

        async function submitTradeProposal() {
            const statusEl = document.getElementById('trade-status');
            
            if (!manageState.tradePartner) {
                statusEl.className = 'submit-status error';
                statusEl.textContent = 'Please select a trade partner';
                return;
            }
            
            if (manageState.tradeGivePlayers.length === 0 && 
                manageState.tradeGivePicks.length === 0 &&
                manageState.tradeReceivePlayers.length === 0 &&
                manageState.tradeReceivePicks.length === 0) {
                statusEl.className = 'submit-status error';
                statusEl.textContent = 'Trade must include at least one player or pick';
                return;
            }
            
            statusEl.className = 'submit-status loading';
            statusEl.textContent = 'Proposing trade...';
            
            try {
                const response = await fetch(MANAGE_CONFIG.apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'propose_trade',
                        team: manageState.team,
                        password: manageState.password,
                        trade_partner: manageState.tradePartner,
                        give_players: manageState.tradeGivePlayers,
                        give_picks: manageState.tradeGivePicks,
                        receive_players: manageState.tradeReceivePlayers,
                        receive_picks: manageState.tradeReceivePicks,
                        current_week: data.current_week
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    statusEl.className = 'submit-status success';
                    statusEl.textContent = result.message;
                    // Reset trade selections
                    manageState.tradeGivePlayers = [];
                    manageState.tradeGivePicks = [];
                    manageState.tradeReceivePlayers = [];
                    manageState.tradeReceivePicks = [];
                    setTimeout(() => loadData(), 2000);
                } else {
                    statusEl.className = 'submit-status error';
                    statusEl.textContent = result.error;
                }
            } catch (e) {
                statusEl.className = 'submit-status error';
                statusEl.textContent = 'Network error - please try again';
            }
        }

        function renderPendingTrades() {
            const container = document.getElementById('pending-trades');
            const pendingTrades = data.pending_trades || [];
            
            // Filter trades involving current team
            const relevantTrades = pendingTrades.filter(t => 
                t.proposer === manageState.team || t.partner === manageState.team
            );
            
            if (relevantTrades.length === 0) {
                container.innerHTML = '<p class="no-pending-trades">No pending trades</p>';
                return;
            }
            
            container.innerHTML = relevantTrades.map(trade => {
                const isProposer = trade.proposer === manageState.team;
                const otherTeam = isProposer ? trade.partner : trade.proposer;
                const otherTeamData = getTeamData(otherTeam);
                const otherTeamName = otherTeamData ? otherTeamData.name : otherTeam;
                
                return `
                    <div class="pending-trade-card" data-trade-id="${trade.id}">
                        <div class="pending-trade-header">
                            <span class="pending-trade-teams">
                                ${isProposer ? 'You â†’ ' + otherTeamName : otherTeamName + ' â†’ You'}
                            </span>
                            <span class="pending-status-badge ${trade.status}">${trade.status.toUpperCase()}</span>
                        </div>
                        <div class="pending-trade-details">
                            <div class="pending-trade-side">
                                <h5>${isProposer ? 'You give' : 'You receive'}</h5>
                                <ul>
                                    ${trade.proposer_gives.players.map(p => `<li>${p}</li>`).join('')}
                                    ${trade.proposer_gives.picks.map(p => `<li>${p}</li>`).join('')}
                                    ${trade.proposer_gives.players.length === 0 && trade.proposer_gives.picks.length === 0 ? '<li>(nothing)</li>' : ''}
                                </ul>
                            </div>
                            <div class="pending-trade-side">
                                <h5>${isProposer ? 'You receive' : 'You give'}</h5>
                                <ul>
                                    ${trade.proposer_receives.players.map(p => `<li>${p}</li>`).join('')}
                                    ${trade.proposer_receives.picks.map(p => `<li>${p}</li>`).join('')}
                                    ${trade.proposer_receives.players.length === 0 && trade.proposer_receives.picks.length === 0 ? '<li>(nothing)</li>' : ''}
                                </ul>
                            </div>
                        </div>
                        ${trade.status === 'pending' && !isProposer ? `
                            <div class="pending-trade-actions">
                                <button class="lineup-btn accept-btn" onclick="respondToTrade('${trade.id}', true)">Accept</button>
                                <button class="lineup-btn reject-btn" onclick="respondToTrade('${trade.id}', false)">Reject</button>
                            </div>
                        ` : ''}
                        ${trade.status === 'pending' && isProposer ? `
                            <div class="pending-trade-actions">
                                <p style="color: var(--text-secondary); margin: 0;">Waiting for ${otherTeamName} to respond</p>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        async function respondToTrade(tradeId, accept) {
            const statusEl = document.getElementById('pending-status');
            statusEl.className = 'submit-status loading';
            statusEl.textContent = accept ? 'Accepting trade...' : 'Rejecting trade...';
            
            try {
                const response = await fetch(MANAGE_CONFIG.apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'respond_trade',
                        team: manageState.team,
                        password: manageState.password,
                        trade_id: tradeId,
                        accept: accept
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    statusEl.className = 'submit-status success';
                    statusEl.textContent = result.message;
                    setTimeout(() => loadData(), 2000);
                } else {
                    statusEl.className = 'submit-status error';
                    statusEl.textContent = result.error;
                }
            } catch (e) {
                statusEl.className = 'submit-status error';
                statusEl.textContent = 'Network error - please try again';
            }
        }

        // Auto-refresh every 5 minutes during game windows
        function checkRefresh() {
            const now = new Date();
            const day = now.getDay(); // 0=Sun, 4=Thu, 1=Mon
            const hour = now.getHours();
            
            let inGameWindow = false;
            if (day === 4 && hour >= 20) inGameWindow = true; // Thursday night
            if (day === 0 && hour >= 12) inGameWindow = true; // Sunday afternoon
            if (day === 1 && hour >= 20) inGameWindow = true; // Monday night
            
            if (inGameWindow) {
                setTimeout(() => {
                    loadData();
                    checkRefresh();
                }, 5 * 60 * 1000); // 5 minutes
            } else {
                setTimeout(checkRefresh, 30 * 60 * 1000); // Check again in 30 min
            }
        }

        loadData();
        checkRefresh();
    </script>
</body>
</html>

